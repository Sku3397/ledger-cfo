2025-04-17 19:13:04,422 - CFOAgentLogger - INFO - Configuration loaded successfully
2025-04-17 19:13:07,497 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 19:13:07,498 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 19:13:07,499 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 19:13:07,499 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 19:13:07,500 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 19:13:07,501 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 19:13:07,502 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 19:13:07,502 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 19:13:07,502 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 19:13:11,188 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 19:13:11,188 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 19:13:11,194 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 19:13:11,195 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 19:13:11,196 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 19:13:11,197 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 19:13:11,198 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 19:13:11,199 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 19:13:11,200 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 19:13:11,230 - CFOAgentLogger - INFO - Attempting OAuth flow on port 8080
2025-04-17 19:13:14,643 - CFOAgentLogger - INFO - Successfully authenticated with Gmail API on port 8080
2025-04-17 19:13:14,643 - CFOAgentLogger - INFO - Saved new credentials to token file
2025-04-17 19:13:15,543 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 19:13:15,639 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 19:13:16,403 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 19:13:16,494 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 19:13:16,494 - CFOAgentLogger - INFO - Attempting Gmail authentication (attempt 1/3)
2025-04-17 19:13:17,279 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 19:13:17,280 - CFOAgentLogger - INFO - Gmail authentication successful
2025-04-17 19:13:17,284 - CFOAgentLogger - INFO - Instant email checking started (every 2.0s)
2025-04-17 19:13:17,285 - CFOAgentLogger - INFO - Instant email checking started successfully
2025-04-17 19:13:17,367 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 19:13:17,368 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 19:13:17,369 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 19:13:17,369 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 19:13:17,370 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 19:13:17,372 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 19:13:17,373 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 19:13:17,374 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 19:13:17,376 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 19:17:14,187 - CFOAgentLogger - INFO - Processing email from Beach Handyman LLC <hello@757handy.com> with subject: new invoice "SPSA-ROB-CARPET"
2025-04-17 19:17:14,188 - CFOAgentLogger - INFO - Instant processing of email: new invoice "SPSA-ROB-CARPET" from Beach Handyman LLC <hello@757handy.com>
2025-04-17 19:17:14,209 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 19:17:14,211 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 19:17:14,212 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 19:17:14,212 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 19:17:14,213 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 19:17:14,223 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 19:17:14,225 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 19:17:14,226 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 19:17:14,227 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 19:17:14,279 - CFOAgentLogger - INFO - Processing new email from Beach Handyman LLC <hello@757handy.com>
2025-04-17 19:17:14,280 - CFOAgentLogger - INFO - Parsing email with subject: new invoice "SPSA-ROB-CARPET"
2025-04-17 19:17:14,281 - CFOAgentLogger - INFO - Email body: create a new invoice for existing customer angie hutchins, invoice/PO
number "SPSA-ROB-CARPET" for: materials: Virginia Highlands Carpet Tiles,
24x24 in, 66 cases. total amount is $12,915. email me a link to view the
invoice on qbo when done.
Matt Porter
Owner / Operations Manager
*Beach Handyman LLC*
757handy.com
*757-354-4577*

2025-04-17 19:17:14,285 - CFOAgentLogger - INFO - Is invoice request: True
2025-04-17 19:17:14,287 - CFOAgentLogger - INFO - Successfully parsed invoice request for existing
2025-04-17 19:17:14,288 - CFOAgentLogger - INFO - Creating draft invoice for existing
2025-04-17 19:17:15,030 - CFOAgentLogger - INFO - Received new refresh token
2025-04-17 19:17:15,030 - CFOAgentLogger - INFO - Successfully refreshed QuickBooks access token
2025-04-17 19:17:16,276 - CFOAgentLogger - INFO - Customer 'existing' not found. Creating new customer.
2025-04-17 19:17:16,277 - CFOAgentLogger - INFO - Creating customer with data: {"DisplayName": "existing", "Active": true}
2025-04-17 19:17:17,269 - CFOAgentLogger - INFO - Created customer with ID: 276
2025-04-17 19:17:18,051 - CFOAgentLogger - INFO - Creating invoice with data: {"CustomerRef": {"value": "276"}, "Line": [{"Amount": 12915.0, "Description": "Virginia Highlands Carpet Tiles", "DetailType": "SalesItemLineDetail", "SalesItemLineDetail": {"ItemRef": {"value": "97"}}}], "CustomerMemo": {"value": "Invoice created automatically from email request."}, "PrivateNote": "Draft invoice - requires approval", "TxnDate": "2025-04-17"}
2025-04-17 19:17:19,483 - CFOAgentLogger - INFO - Invoice creation response type: <class 'dict'>
2025-04-17 19:17:19,483 - CFOAgentLogger - INFO - Invoice response keys: Invoice,time
2025-04-17 19:17:19,483 - CFOAgentLogger - INFO - Found nested Invoice object with keys: AllowIPNPayment,AllowOnlinePayment,AllowOnlineCreditCardPayment,AllowOnlineACHPayment,domain,sparse,Id,SyncToken,MetaData,CustomField,TxnDate,CurrencyRef,PrivateNote,LinkedTxn,Line,CustomerRef,CustomerMemo,DueDate,TotalAmt,ApplyTaxAfterDiscount,PrintStatus,EmailStatus,Balance
2025-04-17 19:17:19,483 - CFOAgentLogger - INFO - Created invoice with ID: 5224, DocNumber: Not assigned
2025-04-17 19:17:19,483 - CFOAgentLogger - INFO - QB Invoice response structure: <class 'dict'>
2025-04-17 19:17:19,483 - CFOAgentLogger - INFO - Found nested Invoice object with keys: AllowIPNPayment,AllowOnlinePayment,AllowOnlineCreditCardPayment,AllowOnlineACHPayment,domain,sparse,Id,SyncToken,MetaData,CustomField,TxnDate,CurrencyRef,PrivateNote,LinkedTxn,Line,CustomerRef,CustomerMemo,DueDate,TotalAmt,ApplyTaxAfterDiscount,PrintStatus,EmailStatus,Balance
2025-04-17 19:17:19,483 - CFOAgentLogger - INFO - Added QBO preview URL: https://app.qbo.intuit.com/app/invoice?txnId=5224
2025-04-17 19:17:19,483 - CFOAgentLogger - INFO - Draft invoice created successfully: Draft-20250417191719
2025-04-17 19:17:19,495 - CFOAgentLogger - INFO - Generating token for invoice: Draft-20250417191719
2025-04-17 19:17:19,497 - CFOAgentLogger - INFO - Token generated for invoice Draft-20250417191719
2025-04-17 19:17:20,134 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 19:17:20,321 - CFOAgentLogger - INFO - Approval email sent for invoice Draft-20250417191719 with Gmail message ID: 196460add0169883
2025-04-17 19:17:20,321 - CFOAgentLogger - INFO - Approval email sent for invoice Draft-20250417191719
2025-04-17 19:48:59,994 - CFOAgentLogger - INFO - Logger initialized successfully
2025-04-17 19:48:59,997 - CFOAgentLogger - INFO - Loaded configuration from .env
2025-04-17 19:48:59,997 - CFOAgentLogger - INFO - Configuration loaded successfully
2025-04-17 19:49:01,889 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 19:49:01,889 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 19:49:01,889 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 19:49:01,889 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 19:49:01,889 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 19:49:01,889 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 19:49:01,889 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 19:49:01,889 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 19:49:01,889 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 19:49:59,430 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 19:49:59,431 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 19:49:59,432 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 19:49:59,448 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 19:49:59,456 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 19:49:59,461 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 19:49:59,462 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 19:49:59,465 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 19:49:59,472 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 19:50:00,199 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 19:50:00,297 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 19:50:00,948 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 19:50:01,059 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 19:50:01,060 - CFOAgentLogger - INFO - Attempting Gmail authentication (attempt 1/3)
2025-04-17 19:50:01,715 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 19:50:01,715 - CFOAgentLogger - INFO - Gmail authentication successful
2025-04-17 19:50:01,715 - CFOAgentLogger - INFO - Instant email checking started (every 2.0s)
2025-04-17 19:50:01,715 - CFOAgentLogger - INFO - Instant email checking started successfully
2025-04-17 19:50:01,808 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 19:50:01,809 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 19:50:01,810 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 19:50:01,811 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 19:50:01,812 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 19:50:01,813 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 19:50:01,814 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 19:50:01,815 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 19:50:01,816 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 19:50:54,492 - CFOAgentLogger - INFO - Processing email from Beach Handyman LLC <hello@757handy.com> with subject: generate invoice for 638 rhode
2025-04-17 19:50:54,492 - CFOAgentLogger - INFO - Instant processing of email: generate invoice for 638 rhode from Beach Handyman LLC <hello@757handy.com>
2025-04-17 19:50:54,497 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 19:50:54,498 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 19:50:54,498 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 19:50:54,499 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 19:50:54,500 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 19:50:54,503 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 19:50:54,514 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 19:50:54,514 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 19:50:54,515 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 19:50:54,566 - CFOAgentLogger - INFO - Processing new email from Beach Handyman LLC <hello@757handy.com>
2025-04-17 19:50:54,567 - CFOAgentLogger - INFO - Parsing email with subject: generate invoice for 638 rhode
2025-04-17 19:50:54,568 - CFOAgentLogger - INFO - Email body: we are done with the work at 638 rhode. please generate the final invoice.
Matt Porter
Owner / Operations Manager
*Beach Handyman LLC*
757handy.com
*757-354-4577*

2025-04-17 19:50:54,569 - CFOAgentLogger - INFO - Is invoice request: True
2025-04-17 19:50:54,569 - CFOAgentLogger - INFO - Found materials description using lenient pattern: 638 rhode we are done with the work at 638 rhode
2025-04-17 19:50:54,569 - CFOAgentLogger - WARNING - Could not extract invoice amount from email
2025-04-17 19:50:54,578 - CFOAgentLogger - WARNING - Failed to parse invoice request from email
2025-04-17 19:58:59,130 - CFOAgentLogger - INFO - Logger initialized successfully
2025-04-17 19:58:59,130 - CFOAgentLogger - INFO - Loaded configuration from .env
2025-04-17 19:58:59,130 - CFOAgentLogger - INFO - Configuration loaded successfully
2025-04-17 19:59:01,413 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 19:59:01,413 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 19:59:01,413 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 19:59:01,413 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 19:59:01,413 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 19:59:01,413 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 19:59:01,413 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 19:59:01,413 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 19:59:01,413 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 19:59:06,546 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 19:59:06,547 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 19:59:06,548 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 19:59:06,550 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 19:59:06,550 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 19:59:06,551 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 19:59:06,552 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 19:59:06,553 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 19:59:06,554 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 19:59:07,386 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 19:59:07,497 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 19:59:08,306 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 19:59:08,402 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 19:59:08,403 - CFOAgentLogger - INFO - Attempting Gmail authentication (attempt 1/3)
2025-04-17 19:59:09,064 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 19:59:09,064 - CFOAgentLogger - INFO - Gmail authentication successful
2025-04-17 19:59:09,068 - CFOAgentLogger - INFO - Instant email checking started (every 2.0s)
2025-04-17 19:59:09,069 - CFOAgentLogger - INFO - Instant email checking started successfully
2025-04-17 19:59:09,157 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 19:59:09,158 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 19:59:09,159 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 19:59:09,160 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 19:59:09,161 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 19:59:09,163 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 19:59:09,164 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 19:59:09,167 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 19:59:09,168 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 19:59:23,588 - CFOAgentLogger - INFO - Processing email from Beach Handyman LLC <hello@757handy.com> with subject: Fwd: generate invoice for 638 rhode
2025-04-17 19:59:23,588 - CFOAgentLogger - INFO - Instant processing of email: Fwd: generate invoice for 638 rhode from Beach Handyman LLC <hello@757handy.com>
2025-04-17 19:59:23,601 - CFOAgentLogger - INFO - Processing new email from Beach Handyman LLC <hello@757handy.com>
2025-04-17 19:59:23,602 - CFOAgentLogger - INFO - Parsing email with subject: Fwd: generate invoice for 638 rhode
2025-04-17 19:59:23,603 - CFOAgentLogger - INFO - Email body: Matt Porter
Owner / Operations Manager
*Beach Handyman LLC*
757handy.com
*757-354-4577*


---------- Forwarded message ---------
From: Beach Handyman LLC <hello@757handy.com>
Date: Thu, Apr 17, 2025 at 7:50 PM
Subject: generate invoice for 638 rhode
To: cfoledger@gmail.com <cfoledger@gmail.com>


we are done with the work at 638 rhode. please generate the final invoice.
Matt Porter
Owner / Operations Manager
*Beach Handyman LLC*
757handy.com
*757-354-4577*

2025-04-17 19:59:23,605 - CFOAgentLogger - INFO - Is invoice request: True
2025-04-17 19:59:23,606 - CFOAgentLogger - INFO - Found materials description using lenient pattern: 638 rhode Matt Porter
2025-04-17 19:59:23,607 - CFOAgentLogger - WARNING - Could not extract invoice amount from email
2025-04-17 19:59:23,608 - CFOAgentLogger - WARNING - Failed to parse invoice request from email
2025-04-17 20:03:05,757 - CFOAgentLogger - INFO - Processing email from Beach Handyman LLC <hello@757handy.com> with subject: Fwd: generate invoice for 638 rhode
2025-04-17 20:03:05,757 - CFOAgentLogger - INFO - Instant processing of email: Fwd: generate invoice for 638 rhode from Beach Handyman LLC <hello@757handy.com>
2025-04-17 20:03:05,757 - CFOAgentLogger - INFO - Processing new email from Beach Handyman LLC <hello@757handy.com>
2025-04-17 20:03:05,769 - CFOAgentLogger - INFO - Parsing email with subject: Fwd: generate invoice for 638 rhode
2025-04-17 20:03:05,770 - CFOAgentLogger - INFO - Email body: Matt Porter
Owner / Operations Manager
*Beach Handyman LLC*
757handy.com
*757-354-4577*


---------- Forwarded message ---------
From: Beach Handyman LLC <hello@757handy.com>
Date: Thu, Apr 17, 2025 at 7:50 PM
Subject: generate invoice for 638 rhode
To: cfoledger@gmail.com <cfoledger@gmail.com>


we are done with the work at 638 rhode. please generate the final invoice.
Matt Porter
Owner / Operations Manager
*Beach Handyman LLC*
757handy.com
*757-354-4577*

2025-04-17 20:03:05,773 - CFOAgentLogger - INFO - Is invoice request: True
2025-04-17 20:03:05,773 - CFOAgentLogger - INFO - Found materials description using lenient pattern: 638 rhode Matt Porter
2025-04-17 20:03:05,774 - CFOAgentLogger - WARNING - Could not extract invoice amount from email
2025-04-17 20:03:05,774 - CFOAgentLogger - WARNING - Failed to parse invoice request from email
2025-04-17 20:03:07,073 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 20:03:07,076 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 20:03:07,077 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 20:03:07,079 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 20:03:07,079 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 20:03:07,118 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 20:03:07,121 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 20:03:07,121 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 20:03:07,122 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 20:03:25,480 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 20:03:25,482 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 20:03:25,485 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 20:03:25,486 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 20:03:25,487 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 20:03:25,488 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 20:03:25,489 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 20:03:25,499 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 20:03:25,502 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 20:03:30,924 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 20:03:30,926 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 20:03:30,927 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 20:03:30,928 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 20:03:30,931 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 20:03:30,933 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 20:03:30,934 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 20:03:30,935 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 20:03:30,936 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 20:03:30,957 - CFOAgentLogger - INFO - Assigned handle_new_email callback to simulator.
2025-04-17 20:03:30,961 - CFOAgentLogger - INFO - Simulating email from hello@757handy.com: new invoice "SPSA-ROB-CARPET"
2025-04-17 20:03:31,085 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 20:03:31,087 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 20:03:31,088 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 20:03:31,091 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 20:03:31,093 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 20:03:31,094 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 20:03:31,096 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 20:03:31,097 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 20:03:31,099 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 20:03:39,645 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 20:03:39,646 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 20:03:39,647 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 20:03:39,648 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 20:03:39,649 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 20:03:39,650 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 20:03:39,651 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 20:03:39,652 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 20:03:39,653 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 20:03:39,672 - CFOAgentLogger - ERROR - Error in test invoice creation: InvoiceRequest.__init__() missing 1 required positional argument: 'raw_email'
Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\main.py", line 1041, in <module>
    invoice_request = InvoiceRequest(
                      ^^^^^^^^^^^^^^^
TypeError: InvoiceRequest.__init__() missing 1 required positional argument: 'raw_email'
2025-04-17 20:06:46,418 - CFOAgentLogger - INFO - Logger initialized successfully
2025-04-17 20:06:46,434 - CFOAgentLogger - INFO - Loaded configuration from .env
2025-04-17 20:06:46,436 - CFOAgentLogger - INFO - Configuration loaded successfully
2025-04-17 20:06:48,353 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 20:06:48,353 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 20:06:48,369 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 20:06:48,369 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 20:06:48,369 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 20:06:48,369 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 20:06:48,369 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 20:06:48,369 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 20:06:48,369 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 20:06:52,060 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 20:06:52,061 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 20:06:52,062 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 20:06:52,064 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 20:06:52,065 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 20:06:52,066 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 20:06:52,067 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 20:06:52,068 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 20:06:52,068 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 20:06:52,826 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 20:06:52,927 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 20:06:53,723 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 20:06:53,824 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 20:06:53,826 - CFOAgentLogger - INFO - Attempting Gmail authentication (attempt 1/3)
2025-04-17 20:06:54,492 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 20:06:54,492 - CFOAgentLogger - INFO - Gmail authentication successful
2025-04-17 20:06:54,492 - CFOAgentLogger - INFO - Instant email checking started (every 2.0s)
2025-04-17 20:06:54,492 - CFOAgentLogger - INFO - Instant email checking started successfully
2025-04-17 20:06:54,578 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 20:06:54,579 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 20:06:54,580 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 20:06:54,581 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 20:06:54,582 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 20:06:54,583 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 20:06:54,585 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 20:06:54,586 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 20:06:54,587 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 20:07:09,509 - CFOAgentLogger - INFO - Processing email from Beach Handyman LLC <hello@757handy.com> with subject: Fwd: generate invoice for 638 rhode
2025-04-17 20:07:09,509 - CFOAgentLogger - INFO - Instant processing of email: Fwd: generate invoice for 638 rhode from Beach Handyman LLC <hello@757handy.com>
2025-04-17 20:07:09,540 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 20:07:09,541 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 20:07:09,542 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 20:07:09,543 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 20:07:09,544 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 20:07:09,558 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 20:07:09,559 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 20:07:09,560 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 20:07:09,561 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 20:07:09,595 - CFOAgentLogger - INFO - Processing new email from Beach Handyman LLC <hello@757handy.com>
2025-04-17 20:07:09,596 - CFOAgentLogger - INFO - Parsing email with subject: Fwd: generate invoice for 638 rhode
2025-04-17 20:07:09,597 - CFOAgentLogger - INFO - Email body: Matt Porter
Owner / Operations Manager
*Beach Handyman LLC*
757handy.com
*757-354-4577*


---------- Forwarded message ---------
From: Beach Handyman LLC <hello@757handy.com>
Date: Thu, Apr 17, 2025 at 7:50 PM
Subject: generate invoice for 638 rhode
To: cfoledger@gmail.com <cfoledger@gmail.com>


we are done with the work at 638 rhode. please generate the final invoice.
Matt Porter
Owner / Operations Manager
*Beach Handyman LLC*
757handy.com
*757-354-4577*

2025-04-17 20:07:09,601 - CFOAgentLogger - INFO - Is invoice request: True
2025-04-17 20:07:09,601 - CFOAgentLogger - INFO - Found materials description using lenient pattern: 638 rhode Matt Porter
2025-04-17 20:07:09,607 - CFOAgentLogger - WARNING - Could not extract invoice amount from email
2025-04-17 20:07:09,610 - CFOAgentLogger - INFO - Created incomplete invoice request. Missing: amount
2025-04-17 20:07:09,611 - CFOAgentLogger - INFO - Created pending invoice request req-20250417200709. Missing fields: amount
2025-04-17 20:07:10,176 - CFOAgentLogger - INFO - Received new refresh token
2025-04-17 20:07:10,176 - CFOAgentLogger - INFO - Successfully refreshed QuickBooks access token
2025-04-17 20:07:10,993 - CFOAgentLogger - ERROR - QuickBooks API error: 400 - {"Fault": {"Error": [{"Message": "Error parsing query", "Detail": "QueryParserError: Invalid content. Lexical error at line 1, column 70.  Encountered: \"\\r\" (13), after : \"\\'%638 Rhode Matt Porter\"", "code": "4000"}], "type": "ValidationFault"}, "time": "2025-04-17T17:07:10.140-07:00"}
NoneType: None
2025-04-17 20:07:10,993 - CFOAgentLogger - ERROR - QuickBooks API request error: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Customer+WHERE+DisplayName+LIKE+%27%25638+Rhode+Matt+Porter%0D%0AOwner%25%27
Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 136, in _make_api_request
    response.raise_for_status()
  File "C:\Users\Matt\AppData\Roaming\Python\Python312\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Customer+WHERE+DisplayName+LIKE+%27%25638+Rhode+Matt+Porter%0D%0AOwner%25%27
2025-04-17 20:07:11,028 - CFOAgentLogger - ERROR - Error querying customers: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Customer+WHERE+DisplayName+LIKE+%27%25638+Rhode+Matt+Porter%0D%0AOwner%25%27
Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 350, in query_customers
    response = self._make_api_request("query", params={"query": query})
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 136, in _make_api_request
    response.raise_for_status()
  File "C:\Users\Matt\AppData\Roaming\Python\Python312\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Customer+WHERE+DisplayName+LIKE+%27%25638+Rhode+Matt+Porter%0D%0AOwner%25%27
2025-04-17 20:07:11,031 - CFOAgentLogger - INFO - Customer '638 Rhode Matt Porter
Owner' not found. Creating new customer.
2025-04-17 20:07:11,032 - CFOAgentLogger - INFO - Creating customer with data: {"DisplayName": "638 Rhode Matt Porter\r\nOwner", "Active": true, "GivenName": "638", "FamilyName": "Rhode Matt Porter Owner"}
2025-04-17 20:07:11,879 - CFOAgentLogger - ERROR - QuickBooks API error: 400 - {"Fault": {"Error": [{"Message": "Invalid String. The String may contain unsupported or illegal chars", "Detail": "Element contains invalid characters. 638 Rhode Matt Porter\r\nOwner", "code": "2040", "element": "DisplayName"}], "type": "ValidationFault"}, "time": "2025-04-17T17:07:11.015-07:00"}
NoneType: None
2025-04-17 20:07:11,879 - CFOAgentLogger - ERROR - QuickBooks API request error: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/customer
Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 136, in _make_api_request
    response.raise_for_status()
  File "C:\Users\Matt\AppData\Roaming\Python\Python312\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/customer
2025-04-17 20:07:11,879 - CFOAgentLogger - ERROR - Error creating customer: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/customer
Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 386, in create_customer
    response = self._make_api_request("customer", method="POST", data=customer_data)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 136, in _make_api_request
    response.raise_for_status()
  File "C:\Users\Matt\AppData\Roaming\Python\Python312\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/customer
2025-04-17 20:07:11,879 - CFOAgentLogger - ERROR - Customer data: {"DisplayName": "638 Rhode Matt Porter\r\nOwner", "Active": true, "GivenName": "638", "FamilyName": "Rhode Matt Porter Owner"}
Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 386, in create_customer
    response = self._make_api_request("customer", method="POST", data=customer_data)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 136, in _make_api_request
    response.raise_for_status()
  File "C:\Users\Matt\AppData\Roaming\Python\Python312\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/customer
2025-04-17 20:07:11,892 - CFOAgentLogger - INFO - Retrying with simplified customer data: {"DisplayName": "638 Rhode Matt Porter\r\nOwner", "Active": true}
2025-04-17 20:07:12,408 - CFOAgentLogger - ERROR - QuickBooks API error: 400 - {"Fault": {"Error": [{"Message": "Invalid String. The String may contain unsupported or illegal chars", "Detail": "Element contains invalid characters. 638 Rhode Matt Porter\r\nOwner", "code": "2040", "element": "DisplayName"}], "type": "ValidationFault"}, "time": "2025-04-17T17:07:11.506-07:00"}
Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 386, in create_customer
    response = self._make_api_request("customer", method="POST", data=customer_data)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 136, in _make_api_request
    response.raise_for_status()
  File "C:\Users\Matt\AppData\Roaming\Python\Python312\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/customer
2025-04-17 20:07:12,411 - CFOAgentLogger - ERROR - QuickBooks API request error: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/customer
Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 386, in create_customer
    response = self._make_api_request("customer", method="POST", data=customer_data)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 136, in _make_api_request
    response.raise_for_status()
  File "C:\Users\Matt\AppData\Roaming\Python\Python312\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/customer

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 136, in _make_api_request
    response.raise_for_status()
  File "C:\Users\Matt\AppData\Roaming\Python\Python312\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/customer
2025-04-17 20:07:12,416 - CFOAgentLogger - ERROR - Error in simplified customer creation: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/customer
Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 386, in create_customer
    response = self._make_api_request("customer", method="POST", data=customer_data)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 136, in _make_api_request
    response.raise_for_status()
  File "C:\Users\Matt\AppData\Roaming\Python\Python312\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/customer

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 407, in create_customer
    response = self._make_api_request("customer", method="POST", data=simple_data)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 136, in _make_api_request
    response.raise_for_status()
  File "C:\Users\Matt\AppData\Roaming\Python\Python312\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/customer
2025-04-17 20:07:12,421 - CFOAgentLogger - ERROR - Failed to create customer: 638 Rhode Matt Porter
Owner
NoneType: None
2025-04-17 20:07:12,422 - CFOAgentLogger - INFO - Incomplete invoice request. Missing: amount
2025-04-17 20:07:12,423 - CFOAgentLogger - ERROR - Error sending request for missing information: 'ApprovalWorkflow' object has no attribute 'send_email'
Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\main.py", line 273, in handle_new_email
    approval_workflow.send_email(
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'ApprovalWorkflow' object has no attribute 'send_email'. Did you mean: 'sender_email'?
2025-04-17 20:09:28,915 - CFOAgentLogger - ERROR - Error checking for emails: The credentials do not contain the necessary fields need to refresh the access token. You must specify refresh_token, token_uri, client_id, and client_secret.
Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\instant_email_checker.py", line 198, in _check_for_emails
    ).execute()
      ^^^^^^^^^
  File "C:\Users\Matt\AppData\Roaming\Python\Python312\site-packages\googleapiclient\_helpers.py", line 130, in positional_wrapper
    return wrapped(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Matt\AppData\Roaming\Python\Python312\site-packages\googleapiclient\http.py", line 923, in execute
    resp, content = _retry_request(
                    ^^^^^^^^^^^^^^^
  File "C:\Users\Matt\AppData\Roaming\Python\Python312\site-packages\googleapiclient\http.py", line 191, in _retry_request
    resp, content = http.request(uri, method, *args, **kwargs)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "F:\Program Files\PYTHON\Lib\site-packages\google_auth_httplib2.py", line 209, in request
    self.credentials.before_request(self._request, method, uri, request_headers)
  File "F:\Program Files\PYTHON\Lib\site-packages\google\auth\credentials.py", line 239, in before_request
    self._blocking_refresh(request)
  File "F:\Program Files\PYTHON\Lib\site-packages\google\auth\credentials.py", line 202, in _blocking_refresh
    self.refresh(request)
  File "F:\Program Files\PYTHON\Lib\site-packages\google\oauth2\credentials.py", line 397, in refresh
    raise exceptions.RefreshError(
google.auth.exceptions.RefreshError: The credentials do not contain the necessary fields need to refresh the access token. You must specify refresh_token, token_uri, client_id, and client_secret.
2025-04-17 20:09:28,962 - CFOAgentLogger - ERROR - Gmail token refresh error (retry 1)
Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\instant_email_checker.py", line 130, in _check_loop
    self._check_for_emails()
  File "C:\Users\Matt\CFO_Agent\instant_email_checker.py", line 198, in _check_for_emails
    ).execute()
      ^^^^^^^^^
  File "C:\Users\Matt\AppData\Roaming\Python\Python312\site-packages\googleapiclient\_helpers.py", line 130, in positional_wrapper
    return wrapped(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Matt\AppData\Roaming\Python\Python312\site-packages\googleapiclient\http.py", line 923, in execute
    resp, content = _retry_request(
                    ^^^^^^^^^^^^^^^
  File "C:\Users\Matt\AppData\Roaming\Python\Python312\site-packages\googleapiclient\http.py", line 191, in _retry_request
    resp, content = http.request(uri, method, *args, **kwargs)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "F:\Program Files\PYTHON\Lib\site-packages\google_auth_httplib2.py", line 209, in request
    self.credentials.before_request(self._request, method, uri, request_headers)
  File "F:\Program Files\PYTHON\Lib\site-packages\google\auth\credentials.py", line 239, in before_request
    self._blocking_refresh(request)
  File "F:\Program Files\PYTHON\Lib\site-packages\google\auth\credentials.py", line 202, in _blocking_refresh
    self.refresh(request)
  File "F:\Program Files\PYTHON\Lib\site-packages\google\oauth2\credentials.py", line 397, in refresh
    raise exceptions.RefreshError(
google.auth.exceptions.RefreshError: The credentials do not contain the necessary fields need to refresh the access token. You must specify refresh_token, token_uri, client_id, and client_secret.
2025-04-17 20:09:28,980 - CFOAgentLogger - INFO - Revoking credentials and attempting to reauthenticate
2025-04-17 20:09:28,982 - CFOAgentLogger - INFO - Removed token file to force reauthentication
2025-04-17 20:09:28,982 - CFOAgentLogger - INFO - Attempting Gmail authentication (attempt 1/3)
2025-04-17 20:09:28,983 - CFOAgentLogger - INFO - Attempting OAuth flow on port 8080
2025-04-17 20:09:29,515 - CFOAgentLogger - ERROR - Error checking for emails: The credentials do not contain the necessary fields need to refresh the access token. You must specify refresh_token, token_uri, client_id, and client_secret.
Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\instant_email_checker.py", line 198, in _check_for_emails
    ).execute()
      ^^^^^^^^^
  File "C:\Users\Matt\AppData\Roaming\Python\Python312\site-packages\googleapiclient\_helpers.py", line 130, in positional_wrapper
    return wrapped(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Matt\AppData\Roaming\Python\Python312\site-packages\googleapiclient\http.py", line 923, in execute
    resp, content = _retry_request(
                    ^^^^^^^^^^^^^^^
  File "C:\Users\Matt\AppData\Roaming\Python\Python312\site-packages\googleapiclient\http.py", line 191, in _retry_request
    resp, content = http.request(uri, method, *args, **kwargs)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "F:\Program Files\PYTHON\Lib\site-packages\google_auth_httplib2.py", line 209, in request
    self.credentials.before_request(self._request, method, uri, request_headers)
  File "F:\Program Files\PYTHON\Lib\site-packages\google\auth\credentials.py", line 239, in before_request
    self._blocking_refresh(request)
  File "F:\Program Files\PYTHON\Lib\site-packages\google\auth\credentials.py", line 202, in _blocking_refresh
    self.refresh(request)
  File "F:\Program Files\PYTHON\Lib\site-packages\google\oauth2\credentials.py", line 397, in refresh
    raise exceptions.RefreshError(
google.auth.exceptions.RefreshError: The credentials do not contain the necessary fields need to refresh the access token. You must specify refresh_token, token_uri, client_id, and client_secret.
2025-04-17 20:09:29,524 - CFOAgentLogger - ERROR - Gmail token refresh error (retry 1)
Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\instant_email_checker.py", line 130, in _check_loop
    self._check_for_emails()
  File "C:\Users\Matt\CFO_Agent\instant_email_checker.py", line 198, in _check_for_emails
    ).execute()
      ^^^^^^^^^
  File "C:\Users\Matt\AppData\Roaming\Python\Python312\site-packages\googleapiclient\_helpers.py", line 130, in positional_wrapper
    return wrapped(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Matt\AppData\Roaming\Python\Python312\site-packages\googleapiclient\http.py", line 923, in execute
    resp, content = _retry_request(
                    ^^^^^^^^^^^^^^^
  File "C:\Users\Matt\AppData\Roaming\Python\Python312\site-packages\googleapiclient\http.py", line 191, in _retry_request
    resp, content = http.request(uri, method, *args, **kwargs)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "F:\Program Files\PYTHON\Lib\site-packages\google_auth_httplib2.py", line 209, in request
    self.credentials.before_request(self._request, method, uri, request_headers)
  File "F:\Program Files\PYTHON\Lib\site-packages\google\auth\credentials.py", line 239, in before_request
    self._blocking_refresh(request)
  File "F:\Program Files\PYTHON\Lib\site-packages\google\auth\credentials.py", line 202, in _blocking_refresh
    self.refresh(request)
  File "F:\Program Files\PYTHON\Lib\site-packages\google\oauth2\credentials.py", line 397, in refresh
    raise exceptions.RefreshError(
google.auth.exceptions.RefreshError: The credentials do not contain the necessary fields need to refresh the access token. You must specify refresh_token, token_uri, client_id, and client_secret.
2025-04-17 20:09:29,534 - CFOAgentLogger - INFO - Revoking credentials and attempting to reauthenticate
2025-04-17 20:09:29,538 - CFOAgentLogger - INFO - Attempting Gmail authentication (attempt 1/3)
2025-04-17 20:09:29,539 - CFOAgentLogger - INFO - Attempting OAuth flow on port 8080
2025-04-17 20:09:29,542 - CFOAgentLogger - WARNING - Port 8080 is in use, trying another port
2025-04-17 20:09:29,544 - CFOAgentLogger - INFO - Attempting OAuth flow on port 8090
2025-04-17 20:12:56,307 - CFOAgentLogger - INFO - Successfully authenticated with Gmail API on port 8090
2025-04-17 20:12:56,307 - CFOAgentLogger - INFO - Saved new credentials to token file
2025-04-17 20:12:58,480 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 20:12:58,482 - CFOAgentLogger - INFO - Gmail authentication successful
2025-04-17 20:13:00,861 - CFOAgentLogger - WARNING - Skipped email from unauthorized sender: Google <no-reply@accounts.google.com> (no-reply@accounts.google.com)
2025-04-17 20:13:00,861 - CFOAgentLogger - INFO - Instant processing of email: Security alert from Google <no-reply@accounts.google.com>
2025-04-17 20:23:49,051 - CFOAgentLogger - INFO - Logger initialized successfully
2025-04-17 20:23:49,051 - CFOAgentLogger - INFO - Loaded configuration from .env
2025-04-17 20:23:49,051 - CFOAgentLogger - INFO - Configuration loaded successfully
2025-04-17 20:23:51,013 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 20:23:51,013 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 20:23:51,014 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 20:23:51,014 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 20:23:51,015 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 20:23:51,016 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 20:23:51,016 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 20:23:51,017 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 20:23:51,017 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 20:24:07,442 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 20:24:07,442 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 20:24:07,442 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 20:24:07,454 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 20:24:07,454 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 20:24:07,456 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 20:24:07,467 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 20:24:07,473 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 20:24:07,474 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 20:24:08,237 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 20:24:08,347 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 20:24:08,986 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 20:24:09,103 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 20:24:09,104 - CFOAgentLogger - INFO - Attempting Gmail authentication (attempt 1/3)
2025-04-17 20:24:09,736 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 20:24:09,736 - CFOAgentLogger - INFO - Gmail authentication successful
2025-04-17 20:24:09,736 - CFOAgentLogger - INFO - Instant email checking started (every 2.0s)
2025-04-17 20:24:09,736 - CFOAgentLogger - INFO - Instant email checking started successfully
2025-04-17 20:24:09,827 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 20:24:09,829 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 20:24:09,829 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 20:24:09,830 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 20:24:09,831 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 20:24:09,832 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 20:24:09,833 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 20:24:09,834 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 20:24:09,837 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 20:24:37,355 - CFOAgentLogger - INFO - Processing email from Beach Handyman LLC <hello@757handy.com> with subject: Fwd: generate invoice for 638 rhode
2025-04-17 20:24:37,355 - CFOAgentLogger - INFO - Instant processing of email: Fwd: generate invoice for 638 rhode from Beach Handyman LLC <hello@757handy.com>
2025-04-17 20:24:37,373 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 20:24:37,373 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 20:24:37,376 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 20:24:37,377 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 20:24:37,378 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 20:24:37,391 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 20:24:37,391 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 20:24:37,392 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 20:24:37,393 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 20:24:37,435 - CFOAgentLogger - INFO - Processing new email from Beach Handyman LLC <hello@757handy.com>
2025-04-17 20:24:37,436 - CFOAgentLogger - INFO - Parsing email with subject: Fwd: generate invoice for 638 rhode
2025-04-17 20:24:37,437 - CFOAgentLogger - INFO - Email body: Matt Porter
Owner / Operations Manager
*Beach Handyman LLC*
757handy.com
*757-354-4577*


---------- Forwarded message ---------
From: Beach Handyman LLC <hello@757handy.com>
Date: Thu, Apr 17, 2025 at 7:50 PM
Subject: generate invoice for 638 rhode
To: cfoledger@gmail.com <cfoledger@gmail.com>


we are done with the work at 638 rhode. please generate the final invoice.
Matt Porter
Owner / Operations Manager
*Beach Handyman LLC*
757handy.com
*757-354-4577*

2025-04-17 20:24:37,440 - CFOAgentLogger - INFO - Is invoice request: True
2025-04-17 20:24:37,443 - CFOAgentLogger - INFO - Found materials description using lenient pattern: 638 rhode Matt Porter
2025-04-17 20:24:37,448 - CFOAgentLogger - WARNING - Could not extract invoice amount from email
2025-04-17 20:24:37,450 - CFOAgentLogger - INFO - Created incomplete invoice request. Missing: amount
2025-04-17 20:24:37,450 - CFOAgentLogger - INFO - Created pending invoice request req-20250417202437. Missing fields: amount
2025-04-17 20:24:38,269 - CFOAgentLogger - INFO - Received new refresh token
2025-04-17 20:24:38,269 - CFOAgentLogger - INFO - Successfully refreshed QuickBooks access token
2025-04-17 20:24:39,036 - CFOAgentLogger - ERROR - QuickBooks API error: 400 - {"Fault": {"Error": [{"Message": "Error parsing query", "Detail": "QueryParserError: Invalid content. Lexical error at line 1, column 70.  Encountered: \"\\r\" (13), after : \"\\'%638 Rhode Matt Porter\"", "code": "4000"}], "type": "ValidationFault"}, "time": "2025-04-17T17:24:38.156-07:00"}
NoneType: None
2025-04-17 20:24:39,036 - CFOAgentLogger - ERROR - QuickBooks API request error: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Customer+WHERE+DisplayName+LIKE+%27%25638+Rhode+Matt+Porter%0D%0AOwner%25%27
Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 137, in _make_api_request
    response.raise_for_status()
  File "C:\Users\Matt\AppData\Roaming\Python\Python312\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Customer+WHERE+DisplayName+LIKE+%27%25638+Rhode+Matt+Porter%0D%0AOwner%25%27
2025-04-17 20:24:39,036 - CFOAgentLogger - ERROR - Error querying customers: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Customer+WHERE+DisplayName+LIKE+%27%25638+Rhode+Matt+Porter%0D%0AOwner%25%27
Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 351, in query_customers
    response = self._make_api_request("query", params={"query": query})
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 137, in _make_api_request
    response.raise_for_status()
  File "C:\Users\Matt\AppData\Roaming\Python\Python312\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Customer+WHERE+DisplayName+LIKE+%27%25638+Rhode+Matt+Porter%0D%0AOwner%25%27
2025-04-17 20:24:39,052 - CFOAgentLogger - INFO - Customer '638 Rhode Matt Porter
Owner' not found. Creating new customer.
2025-04-17 20:24:39,053 - CFOAgentLogger - ERROR - Failed to create customer: {'DisplayName': '638 Rhode Matt Porter\r\nOwner', 'Active': True, 'GivenName': '638', 'FamilyName': 'Rhode Matt Porter Owner'}
'dict' object has no attribute 'strip'
Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 371, in create_customer
    if not customer_name or len(customer_name.strip()) == 0:
                                ^^^^^^^^^^^^^^^^^^^
AttributeError: 'dict' object has no attribute 'strip'
2025-04-17 20:24:39,056 - CFOAgentLogger - ERROR - Failed to create customer: 638 Rhode Matt Porter
Owner
NoneType: None
2025-04-17 20:24:39,057 - CFOAgentLogger - INFO - Incomplete invoice request. Missing: amount
2025-04-17 20:24:39,756 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 20:24:39,947 - CFOAgentLogger - INFO - Email sent to hello@757handy.com with Gmail message ID: 196464881f558921
2025-04-17 20:24:39,948 - CFOAgentLogger - INFO - Sent request for missing information to hello@757handy.com
2025-04-17 20:27:20,178 - CFOAgentLogger - INFO - Logger initialized successfully
2025-04-17 20:27:20,178 - CFOAgentLogger - INFO - Loaded configuration from .env
2025-04-17 20:27:20,184 - CFOAgentLogger - INFO - Configuration loaded successfully
2025-04-17 20:27:22,323 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 20:27:22,323 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 20:27:22,324 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 20:27:22,324 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 20:27:22,325 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 20:27:22,326 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 20:27:22,327 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 20:27:22,327 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 20:27:22,328 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 20:27:26,241 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 20:27:26,242 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 20:27:26,246 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 20:27:26,247 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 20:27:26,249 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 20:27:26,252 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 20:27:26,253 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 20:27:26,255 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 20:27:26,256 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 20:27:27,119 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 20:27:27,246 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 20:27:27,885 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 20:27:28,019 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 20:27:28,020 - CFOAgentLogger - INFO - Attempting Gmail authentication (attempt 1/3)
2025-04-17 20:27:28,669 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 20:27:28,669 - CFOAgentLogger - INFO - Gmail authentication successful
2025-04-17 20:27:28,669 - CFOAgentLogger - INFO - Instant email checking started (every 2.0s)
2025-04-17 20:27:28,669 - CFOAgentLogger - INFO - Instant email checking started successfully
2025-04-17 20:27:28,753 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 20:27:28,754 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 20:27:28,755 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 20:27:28,756 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 20:27:28,757 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 20:27:28,758 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 20:27:28,759 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 20:27:28,761 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 20:27:28,762 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 20:27:56,355 - CFOAgentLogger - INFO - Processing email from Beach Handyman LLC <hello@757handy.com> with subject: Fwd: generate invoice for 638 rhode
2025-04-17 20:27:56,355 - CFOAgentLogger - INFO - Instant processing of email: Fwd: generate invoice for 638 rhode from Beach Handyman LLC <hello@757handy.com>
2025-04-17 20:27:56,355 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 20:27:56,355 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 20:27:56,367 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 20:27:56,368 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 20:27:56,369 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 20:27:56,380 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 20:27:56,381 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 20:27:56,382 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 20:27:56,383 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 20:27:56,424 - CFOAgentLogger - INFO - Processing new email from Beach Handyman LLC <hello@757handy.com>
2025-04-17 20:27:56,428 - CFOAgentLogger - INFO - Parsing email with subject: Fwd: generate invoice for 638 rhode
2025-04-17 20:27:56,430 - CFOAgentLogger - INFO - Email body: Matt Porter
Owner / Operations Manager
*Beach Handyman LLC*
757handy.com
*757-354-4577*


---------- Forwarded message ---------
From: Beach Handyman LLC <hello@757handy.com>
Date: Thu, Apr 17, 2025 at 7:50 PM
Subject: generate invoice for 638 rhode
To: cfoledger@gmail.com <cfoledger@gmail.com>


we are done with the work at 638 rhode. please generate the final invoice.
Matt Porter
Owner / Operations Manager
*Beach Handyman LLC*
757handy.com
*757-354-4577*

2025-04-17 20:27:56,434 - CFOAgentLogger - INFO - Is invoice request: True
2025-04-17 20:27:56,438 - CFOAgentLogger - INFO - Found materials description using lenient pattern: 638 rhode Matt Porter
2025-04-17 20:27:56,440 - CFOAgentLogger - WARNING - Could not extract invoice amount from email
2025-04-17 20:27:56,441 - CFOAgentLogger - INFO - Created incomplete invoice request. Missing: amount
2025-04-17 20:27:56,443 - CFOAgentLogger - INFO - Created pending invoice request req-20250417202756. Missing fields: amount
2025-04-17 20:27:57,102 - CFOAgentLogger - INFO - Received new refresh token
2025-04-17 20:27:57,102 - CFOAgentLogger - INFO - Successfully refreshed QuickBooks access token
2025-04-17 20:27:57,985 - CFOAgentLogger - ERROR - QuickBooks API error: 400 - {"Fault": {"Error": [{"Message": "Error parsing query", "Detail": "QueryParserError: Invalid content. Lexical error at line 1, column 70.  Encountered: \"\\r\" (13), after : \"\\'%638 Rhode Matt Porter\"", "code": "4000"}], "type": "ValidationFault"}, "time": "2025-04-17T17:27:57.158-07:00"}
NoneType: None
2025-04-17 20:27:57,985 - CFOAgentLogger - ERROR - QuickBooks API request error: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Customer+WHERE+DisplayName+LIKE+%27%25638+Rhode+Matt+Porter%0D%0AOwner%25%27
Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 137, in _make_api_request
    response.raise_for_status()
  File "C:\Users\Matt\AppData\Roaming\Python\Python312\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Customer+WHERE+DisplayName+LIKE+%27%25638+Rhode+Matt+Porter%0D%0AOwner%25%27
2025-04-17 20:27:58,001 - CFOAgentLogger - ERROR - Error querying customers: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Customer+WHERE+DisplayName+LIKE+%27%25638+Rhode+Matt+Porter%0D%0AOwner%25%27
Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 351, in query_customers
    response = self._make_api_request("query", params={"query": query})
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 137, in _make_api_request
    response.raise_for_status()
  File "C:\Users\Matt\AppData\Roaming\Python\Python312\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Customer+WHERE+DisplayName+LIKE+%27%25638+Rhode+Matt+Porter%0D%0AOwner%25%27
2025-04-17 20:27:58,006 - CFOAgentLogger - INFO - Customer '638 Rhode Matt Porter
Owner' not found. Creating new customer.
2025-04-17 20:27:58,007 - CFOAgentLogger - ERROR - Failed to create customer: {'DisplayName': '638 Rhode Matt Porter\r\nOwner', 'Active': True, 'GivenName': '638', 'FamilyName': 'Rhode Matt Porter Owner'}
'dict' object has no attribute 'strip'
Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 371, in create_customer
    if not customer_name or len(customer_name.strip()) == 0:
                                ^^^^^^^^^^^^^^^^^^^
AttributeError: 'dict' object has no attribute 'strip'
2025-04-17 20:27:58,010 - CFOAgentLogger - ERROR - Failed to create customer: 638 Rhode Matt Porter
Owner
NoneType: None
2025-04-17 20:27:58,011 - CFOAgentLogger - INFO - Incomplete invoice request. Missing: amount
2025-04-17 20:27:58,652 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 20:27:58,909 - CFOAgentLogger - INFO - Email sent to hello@757handy.com with Gmail message ID: 196464b8bc80c7c8
2025-04-17 20:27:58,909 - CFOAgentLogger - INFO - Sent request for missing information to hello@757handy.com
2025-04-17 21:06:08,416 - CFOAgentLogger - INFO - Logger initialized successfully
2025-04-17 21:06:08,432 - CFOAgentLogger - INFO - Loaded configuration from .env
2025-04-17 21:06:08,434 - CFOAgentLogger - INFO - Configuration loaded successfully
2025-04-17 21:06:11,067 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:06:11,067 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:06:11,067 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:06:11,067 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:06:11,067 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:06:11,067 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:06:11,067 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:06:11,067 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:06:11,067 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:06:14,692 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:06:14,693 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:06:14,693 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:06:14,693 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:06:14,693 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:06:14,693 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:06:14,693 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:06:14,693 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:06:14,693 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:06:21,050 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:06:21,052 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:06:21,055 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:06:21,056 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:06:21,058 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:06:21,060 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:06:21,069 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:06:21,073 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:06:21,074 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:06:22,310 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:06:22,311 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:06:22,312 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:06:22,313 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:06:22,314 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:06:22,315 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:06:22,316 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:06:22,316 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:06:22,317 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:06:22,341 - CFOAgentLogger - INFO - Assigned handle_llm_email_processing callback for simulation.
2025-04-17 21:06:22,345 - CFOAgentLogger - INFO - Simulating email from hello@757handy.com: Invoice for 638 Rhode Island
2025-04-17 21:06:22,452 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:06:22,454 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:06:22,455 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:06:22,456 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:06:22,457 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:06:22,458 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:06:22,460 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:06:22,461 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:06:22,462 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:06:34,476 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:06:34,477 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:06:34,477 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:06:34,477 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:06:34,477 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:06:34,485 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:06:34,491 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:06:34,493 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:06:34,497 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:06:36,368 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:06:36,369 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:06:36,370 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:06:36,371 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:06:36,372 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:06:36,373 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:06:36,373 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:06:36,374 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:06:36,375 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:06:36,395 - CFOAgentLogger - INFO - Assigned handle_llm_email_processing callback for simulation.
2025-04-17 21:06:36,406 - CFOAgentLogger - INFO - Simulating email from hello@757handy.com: new invoice "SPSA-ROB-CARPET"
2025-04-17 21:06:36,512 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:06:36,513 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:06:36,514 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:06:36,515 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:06:36,516 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:06:36,517 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:06:36,518 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:06:36,519 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:06:36,521 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:06:39,181 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:06:39,182 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:06:39,185 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:06:39,188 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:06:39,197 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:06:39,202 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:06:39,205 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:06:39,206 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:06:39,207 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:06:40,264 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:06:40,265 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:06:40,266 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:06:40,267 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:06:40,268 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:06:40,269 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:06:40,273 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:06:40,274 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:06:40,275 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:06:40,289 - CFOAgentLogger - INFO - Assigned handle_llm_email_processing callback for simulation.
2025-04-17 21:06:40,291 - CFOAgentLogger - INFO - Simulating email from hello@757handy.com: Invoice Request - Consulting Services
2025-04-17 21:06:40,396 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:06:40,397 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:06:40,398 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:06:40,398 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:06:40,399 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:06:40,400 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:06:40,401 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:06:40,403 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:06:40,403 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:06:42,157 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:06:42,158 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:06:42,161 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:06:42,161 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:06:42,163 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:06:42,164 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:06:42,182 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:06:42,184 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:06:42,184 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:06:43,233 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:06:43,234 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:06:43,235 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:06:43,236 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:06:43,236 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:06:43,238 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:06:43,240 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:06:43,241 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:06:43,241 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:06:43,257 - CFOAgentLogger - INFO - Assigned handle_llm_email_processing callback for simulation.
2025-04-17 21:06:43,272 - CFOAgentLogger - INFO - Simulating email from hello@757handy.com: Invoice for 638 Rhode Island
2025-04-17 21:06:43,371 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:06:43,372 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:06:43,373 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:06:43,374 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:06:43,375 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:06:43,377 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:06:43,378 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:06:43,379 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:06:43,380 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:10:18,761 - CFOAgentLogger - INFO - Logger initialized successfully
2025-04-17 21:10:18,765 - CFOAgentLogger - INFO - Loaded configuration from .env
2025-04-17 21:10:18,766 - CFOAgentLogger - INFO - Configuration loaded successfully
2025-04-17 21:10:18,798 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:10:18,799 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:10:18,799 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:10:18,800 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:10:18,801 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:10:18,802 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:10:18,803 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:10:18,806 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:10:18,806 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:10:18,954 - CFOAgentLogger - INFO - Saved new credentials to token file
2025-04-17 21:10:19,654 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:10:19,763 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:10:20,439 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:10:20,540 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:10:20,542 - CFOAgentLogger - INFO - Attempting Gmail authentication (attempt 1/3)
2025-04-17 21:10:21,197 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:10:21,208 - CFOAgentLogger - INFO - Gmail authentication successful
2025-04-17 21:10:21,227 - CFOAgentLogger - INFO - Instant email checking started (every 2.0s)
2025-04-17 21:10:21,231 - CFOAgentLogger - INFO - Instant email checking started successfully
2025-04-17 21:10:21,328 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:10:21,328 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:10:21,329 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:10:21,330 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:10:21,331 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:10:21,332 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:10:21,333 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:10:21,334 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:10:21,337 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:10:21,720 - CFOAgentLogger - INFO - Processing email from Beach Handyman LLC <hello@757handy.com> with subject: Fwd: generate invoice for 638 rhode
2025-04-17 21:10:21,720 - CFOAgentLogger - INFO - Instant processing of email: Fwd: generate invoice for 638 rhode from Beach Handyman LLC <hello@757handy.com>
2025-04-17 21:10:21,755 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:10:21,755 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:10:21,755 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:10:21,755 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:10:21,755 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:10:21,775 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:10:21,776 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:10:21,777 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:10:21,778 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:10:21,822 - CFOAgentLogger - INFO - Processing new email via LLM: ID=196466f7834c903f, From=Unknown Sender, Subject=Fwd: generate invoice for 638 rhode
2025-04-17 21:10:21,823 - CFOAgentLogger - INFO - Simulating LLM response for email body: Matt Porter
Owner / Operations Manager
*Beach Handyman LLC*
757handy.com
*757-354-4577*


---------- Forwarded message ---------
From: Beach Handyman LLC <hello@757handy.com>
Date: Thu, Apr 1...
2025-04-17 21:10:21,825 - CFOAgentLogger - INFO - LLM Simulation: Detected invoice creation request.
2025-04-17 21:10:21,826 - CFOAgentLogger - INFO - LLM Simulation: Extracted customer query: '638 rhode'
2025-04-17 21:10:21,828 - CFOAgentLogger - INFO - LLM Simulation: Extracted amount: None
2025-04-17 21:10:21,829 - CFOAgentLogger - INFO - LLM Simulation: Extracted estimate ID: None
2025-04-17 21:10:21,831 - CFOAgentLogger - INFO - LLM Simulation: Choosing 'ask_user_for_clarification' (missing amount).
2025-04-17 21:10:21,833 - CFOAgentLogger - INFO - LLM requested clarification for email 196466f7834c903f: I see you want an invoice for '638 rhode'. Could you please provide the amount or an estimate number?
2025-04-17 21:10:21,835 - CFOAgentLogger - ERROR - Could not extract valid email address from sender: Unknown Sender for clarification request.
NoneType: None
2025-04-17 21:10:49,650 - CFOAgentLogger - INFO - Processing email from Beach Handyman LLC <hello@757handy.com> with subject: Fwd: generate invoice for 638 rhode
2025-04-17 21:10:49,650 - CFOAgentLogger - INFO - Instant processing of email: Fwd: generate invoice for 638 rhode from Beach Handyman LLC <hello@757handy.com>
2025-04-17 21:10:49,653 - CFOAgentLogger - INFO - Processing new email via LLM: ID=1964672b7313a6c6, From=Unknown Sender, Subject=Fwd: generate invoice for 638 rhode
2025-04-17 21:10:49,654 - CFOAgentLogger - INFO - Simulating LLM response for email body: Matt Porter
Owner / Operations Manager
*Beach Handyman LLC*
757handy.com
*757-354-4577*


---------- Forwarded message ---------
From: Beach Handyman LLC <hello@757handy.com>
Date: Thu, Apr 1...
2025-04-17 21:10:49,655 - CFOAgentLogger - INFO - LLM Simulation: Detected invoice creation request.
2025-04-17 21:10:49,657 - CFOAgentLogger - INFO - LLM Simulation: Extracted customer query: '638 rhode'
2025-04-17 21:10:49,658 - CFOAgentLogger - INFO - LLM Simulation: Extracted amount: None
2025-04-17 21:10:49,660 - CFOAgentLogger - INFO - LLM Simulation: Extracted estimate ID: None
2025-04-17 21:10:49,660 - CFOAgentLogger - INFO - LLM Simulation: Choosing 'ask_user_for_clarification' (missing amount).
2025-04-17 21:10:49,662 - CFOAgentLogger - INFO - LLM requested clarification for email 1964672b7313a6c6: I see you want an invoice for '638 rhode'. Could you please provide the amount or an estimate number?
2025-04-17 21:10:49,663 - CFOAgentLogger - ERROR - Could not extract valid email address from sender: Unknown Sender for clarification request.
NoneType: None
2025-04-17 21:13:55,379 - CFOAgentLogger - INFO - Logger initialized successfully
2025-04-17 21:13:55,383 - CFOAgentLogger - INFO - Loaded configuration from .env
2025-04-17 21:13:55,384 - CFOAgentLogger - INFO - Configuration loaded successfully
2025-04-17 21:13:55,411 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:13:55,412 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:13:55,413 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:13:55,415 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:13:55,416 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:13:55,418 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:13:55,419 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:13:55,420 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:13:55,421 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:13:55,426 - CFOAgentLogger - INFO - Instant email checking stopped
2025-04-17 21:13:55,428 - CFOAgentLogger - INFO - Email monitoring stopped completely
2025-04-17 21:13:55,525 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:13:55,526 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:13:55,527 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:13:55,527 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:13:55,529 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:13:55,530 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:13:55,532 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:13:55,533 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:13:55,536 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:13:56,775 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:13:56,775 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:13:56,775 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:13:56,775 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:13:56,775 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:13:56,775 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:13:56,786 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:13:56,793 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:13:56,794 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:13:57,453 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:13:57,550 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:13:58,187 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:13:58,286 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:13:58,286 - CFOAgentLogger - INFO - Attempting Gmail authentication (attempt 1/3)
2025-04-17 21:13:58,913 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:13:58,915 - CFOAgentLogger - INFO - Gmail authentication successful
2025-04-17 21:13:58,919 - CFOAgentLogger - INFO - Instant email checking started (every 2.0s)
2025-04-17 21:13:58,920 - CFOAgentLogger - INFO - Instant email checking started successfully
2025-04-17 21:13:59,007 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:13:59,008 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:13:59,009 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:13:59,009 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:13:59,010 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:13:59,011 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:13:59,012 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:13:59,014 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:13:59,015 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:14:25,577 - CFOAgentLogger - INFO - Processing email from Beach Handyman LLC <hello@757handy.com> with subject: Fwd: generate invoice for 638 rhode
2025-04-17 21:14:25,577 - CFOAgentLogger - INFO - Instant processing of email: Fwd: generate invoice for 638 rhode from Beach Handyman LLC <hello@757handy.com>
2025-04-17 21:14:25,577 - CFOAgentLogger - INFO - Processing new email via LLM: ID=1964676076c819cf, From=Unknown Sender, Subject=Fwd: generate invoice for 638 rhode
2025-04-17 21:14:25,577 - CFOAgentLogger - INFO - Simulating LLM response for email body: Matt Porter
Owner / Operations Manager
*Beach Handyman LLC*
757handy.com
*757-354-4577*


---------- Forwarded message ---------
From: Beach Handyman LLC <hello@757handy.com>
Date: Thu, Apr 1...
2025-04-17 21:14:25,577 - CFOAgentLogger - INFO - LLM Simulation: Detected invoice creation request.
2025-04-17 21:14:25,577 - CFOAgentLogger - INFO - LLM Simulation: Extracted customer query: '638 rhode'
2025-04-17 21:14:25,577 - CFOAgentLogger - INFO - LLM Simulation: Extracted amount: None
2025-04-17 21:14:25,577 - CFOAgentLogger - INFO - LLM Simulation: Extracted estimate ID: None
2025-04-17 21:14:25,592 - CFOAgentLogger - INFO - LLM Simulation: Choosing 'ask_user_for_clarification' (missing amount).
2025-04-17 21:14:25,593 - CFOAgentLogger - INFO - LLM requested clarification for email 1964676076c819cf: I see you want an invoice for '638 rhode'. Could you please provide the amount or an estimate number?
2025-04-17 21:14:25,594 - CFOAgentLogger - ERROR - Could not extract valid email address from sender: Unknown Sender for clarification request.
NoneType: None
2025-04-17 21:16:20,343 - CFOAgentLogger - INFO - Logger initialized successfully
2025-04-17 21:16:20,347 - CFOAgentLogger - INFO - Loaded configuration from .env
2025-04-17 21:16:20,348 - CFOAgentLogger - INFO - Configuration loaded successfully
2025-04-17 21:16:20,378 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:16:20,378 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:16:20,379 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:16:20,380 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:16:20,381 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:16:20,395 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:16:20,396 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:16:20,397 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:16:20,398 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:16:20,405 - CFOAgentLogger - INFO - Instant email checking stopped
2025-04-17 21:16:20,407 - CFOAgentLogger - INFO - Email monitoring stopped completely
2025-04-17 21:16:20,502 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:16:20,504 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:16:20,505 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:16:20,506 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:16:20,507 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:16:20,508 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:16:20,510 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:16:20,511 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:16:20,511 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:16:21,303 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:16:21,303 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:16:21,303 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:16:21,303 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:16:21,303 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:16:21,312 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:16:21,314 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:16:21,315 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:16:21,319 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:16:22,018 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:16:22,127 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:16:22,785 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:16:22,893 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:16:22,894 - CFOAgentLogger - INFO - Attempting Gmail authentication (attempt 1/3)
2025-04-17 21:16:23,600 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:16:23,602 - CFOAgentLogger - INFO - Gmail authentication successful
2025-04-17 21:16:23,606 - CFOAgentLogger - INFO - Instant email checking started (every 2.0s)
2025-04-17 21:16:23,607 - CFOAgentLogger - INFO - Instant email checking started successfully
2025-04-17 21:16:23,691 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:16:23,694 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:16:23,694 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:16:23,695 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:16:23,696 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:16:23,697 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:16:23,698 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:16:23,698 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:16:23,699 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:16:42,804 - CFOAgentLogger - INFO - Processing email from Beach Handyman LLC <hello@757handy.com> with subject: Fwd: generate invoice for 638 rhode
2025-04-17 21:16:42,804 - CFOAgentLogger - INFO - Instant processing of email: 'Fwd: generate invoice for 638 rhode' from Beach Handyman LLC <hello@757handy.com>
2025-04-17 21:16:42,804 - CFOAgentLogger - INFO - Processing new email via LLM: ID=1964678205b1ba9e, From='Beach Handyman LLC <hello@757handy.com>', Subject='Fwd: generate invoice for 638 rhode'
2025-04-17 21:16:42,804 - CFOAgentLogger - INFO - Simulating LLM response for email body: Matt Porter
Owner / Operations Manager
*Beach Handyman LLC*
757handy.com
*757-354-4577*


---------- Forwarded message ---------
From: Beach Handyman LLC <hello@757handy.com>
Date: Thu, Apr 1...
2025-04-17 21:16:42,804 - CFOAgentLogger - INFO - LLM Simulation: Detected invoice creation request.
2025-04-17 21:16:42,804 - CFOAgentLogger - INFO - LLM Simulation: Extracted customer query: '638 rhode'
2025-04-17 21:16:42,817 - CFOAgentLogger - INFO - LLM Simulation: Extracted amount: None
2025-04-17 21:16:42,820 - CFOAgentLogger - INFO - LLM Simulation: Extracted estimate ID: None
2025-04-17 21:16:42,821 - CFOAgentLogger - INFO - LLM Simulation: Choosing 'ask_user_for_clarification' (missing amount).
2025-04-17 21:16:42,823 - CFOAgentLogger - INFO - LLM requested clarification for email 1964678205b1ba9e: I see you want an invoice for '638 rhode'. Could you please provide the amount or an estimate number?
2025-04-17 21:16:42,825 - CFOAgentLogger - INFO - Sending clarification request to hello@757handy.com: I see you want an invoice for '638 rhode'. Could you please provide the amount or an estimate number?
2025-04-17 21:16:43,452 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:16:43,646 - CFOAgentLogger - INFO - Email sent to hello@757handy.com with Gmail message ID: 19646782ac012d6e
2025-04-17 21:16:43,646 - CFOAgentLogger - INFO - Clarification email sent to hello@757handy.com
2025-04-17 21:21:15,924 - CFOAgentLogger - INFO - Logger initialized successfully
2025-04-17 21:21:15,928 - CFOAgentLogger - INFO - Loaded configuration from .env
2025-04-17 21:21:15,930 - CFOAgentLogger - INFO - Configuration loaded successfully
2025-04-17 21:21:17,910 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:21:17,911 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:21:17,911 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:21:17,912 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:21:17,913 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:21:17,914 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:21:17,915 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:21:17,916 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:21:17,917 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:21:37,027 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:21:37,028 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:21:37,032 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:21:37,035 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:21:37,038 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:21:37,045 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:21:37,046 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:21:37,048 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:21:37,049 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:21:37,901 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:21:38,011 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:21:38,651 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:21:38,751 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:21:38,752 - CFOAgentLogger - INFO - Attempting Gmail authentication (attempt 1/3)
2025-04-17 21:21:39,434 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:21:39,434 - CFOAgentLogger - INFO - Gmail authentication successful
2025-04-17 21:21:39,434 - CFOAgentLogger - INFO - Instant email checking started (every 2.0s)
2025-04-17 21:21:39,434 - CFOAgentLogger - INFO - Instant email checking started successfully
2025-04-17 21:21:39,526 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:21:39,526 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:21:39,527 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:21:39,528 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:21:39,528 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:21:39,530 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:21:39,531 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:21:39,532 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:21:39,534 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:22:13,252 - CFOAgentLogger - INFO - Processing email from Beach Handyman LLC <hello@757handy.com> with subject: Fwd: generate invoice for 638 rhode
2025-04-17 21:22:13,252 - CFOAgentLogger - INFO - Instant processing of email: 'Fwd: generate invoice for 638 rhode' from Beach Handyman LLC <hello@757handy.com>
2025-04-17 21:22:13,301 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:22:13,301 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:22:13,302 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:22:13,303 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:22:13,304 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:22:13,319 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:22:13,319 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:22:13,320 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:22:13,321 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:22:13,357 - CFOAgentLogger - INFO - Processing new email via LLM: ID=196467d262e2ac4b, From='Beach Handyman LLC <hello@757handy.com>', Subject='Fwd: generate invoice for 638 rhode'
2025-04-17 21:22:13,357 - CFOAgentLogger - INFO - Simulating LLM response for email body: Matt Porter
Owner / Operations Manager
*Beach Handyman LLC*
757handy.com
*757-354-4577*


---------- Forwarded message ---------
From: Beach Handyman LLC <hello@757handy.com>
Date: Thu, Apr 1...
2025-04-17 21:22:13,359 - CFOAgentLogger - INFO - LLM Simulation: Detected invoice creation request.
2025-04-17 21:22:13,360 - CFOAgentLogger - INFO - LLM Simulation: Extracted customer query: '638 rhode'
2025-04-17 21:22:13,361 - CFOAgentLogger - INFO - LLM Simulation: Extracted amount: None
2025-04-17 21:22:13,363 - CFOAgentLogger - INFO - LLM Simulation: Extracted estimate ID: None
2025-04-17 21:22:13,364 - CFOAgentLogger - INFO - LLM Simulation: Choosing 'search_quickbooks_context' (missing amount/estimate).
2025-04-17 21:22:13,365 - CFOAgentLogger - INFO - LLM requested tool: search_quickbooks_context with term: '638 rhode'
2025-04-17 21:22:13,366 - CFOAgentLogger - ERROR - Error processing email 196467d262e2ac4b with LLM workflow: name 'EmailNotValidError' is not defined
Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\main.py", line 279, in handle_tool_call
    validate_email(sender_info) # Validate if it's an email
    ^^^^^^^^^^^^^^
NameError: name 'validate_email' is not defined

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\main.py", line 167, in handle_llm_email_processing
    search_results = handle_tool_call(tool_name, tool_args, message_id, reply_to_address or sender_display, subject)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Matt\CFO_Agent\main.py", line 281, in handle_tool_call
    except (EmailNotValidError, TypeError):
            ^^^^^^^^^^^^^^^^^^
NameError: name 'EmailNotValidError' is not defined
2025-04-17 21:22:13,382 - CFOAgentLogger - ERROR - Failed to send processing error email: 'ApprovalWorkflow' object has no attribute 'send_response_email'
Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\main.py", line 279, in handle_tool_call
    validate_email(sender_info) # Validate if it's an email
    ^^^^^^^^^^^^^^
NameError: name 'validate_email' is not defined

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\main.py", line 167, in handle_llm_email_processing
    search_results = handle_tool_call(tool_name, tool_args, message_id, reply_to_address or sender_display, subject)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Matt\CFO_Agent\main.py", line 281, in handle_tool_call
    except (EmailNotValidError, TypeError):
            ^^^^^^^^^^^^^^^^^^
NameError: name 'EmailNotValidError' is not defined

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\main.py", line 260, in handle_llm_email_processing
    approval_workflow.send_response_email(to_email=email_address_to_send, subject=err_subject, body=err_body)
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'ApprovalWorkflow' object has no attribute 'send_response_email'
2025-04-17 21:24:07,192 - CFOAgentLogger - INFO - Logger initialized successfully
2025-04-17 21:24:07,196 - CFOAgentLogger - INFO - Loaded configuration from .env
2025-04-17 21:24:07,198 - CFOAgentLogger - INFO - Configuration loaded successfully
2025-04-17 21:24:09,187 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:24:09,188 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:24:09,189 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:24:09,189 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:24:09,190 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:24:09,192 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:24:09,192 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:24:09,193 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:24:09,193 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:24:14,196 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:24:14,197 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:24:14,200 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:24:14,203 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:24:14,204 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:24:14,207 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:24:14,207 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:24:14,211 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:24:14,211 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:24:15,166 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:24:15,266 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:24:15,966 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:24:16,065 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:24:16,065 - CFOAgentLogger - INFO - Attempting Gmail authentication (attempt 1/3)
2025-04-17 21:24:16,732 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:24:16,732 - CFOAgentLogger - INFO - Gmail authentication successful
2025-04-17 21:24:16,732 - CFOAgentLogger - INFO - Instant email checking started (every 2.0s)
2025-04-17 21:24:16,732 - CFOAgentLogger - INFO - Instant email checking started successfully
2025-04-17 21:24:16,828 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:24:16,829 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:24:16,830 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:24:16,831 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:24:16,832 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:24:16,834 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:24:16,835 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:24:16,836 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:24:16,837 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:24:46,402 - CFOAgentLogger - INFO - Processing email from Beach Handyman LLC <hello@757handy.com> with subject: Fwd: generate invoice for 638 rhode
2025-04-17 21:24:46,402 - CFOAgentLogger - INFO - Instant processing of email: 'Fwd: generate invoice for 638 rhode' from Beach Handyman LLC <hello@757handy.com>
2025-04-17 21:24:46,442 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:24:46,447 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:24:46,448 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:24:46,449 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:24:46,450 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:24:46,465 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:24:46,465 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:24:46,466 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:24:46,467 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:24:46,499 - CFOAgentLogger - INFO - Processing new email via LLM: ID=196467f7c958b527, From='Beach Handyman LLC <hello@757handy.com>', Subject='Fwd: generate invoice for 638 rhode'
2025-04-17 21:24:46,500 - CFOAgentLogger - INFO - Simulating LLM response for email body: Matt Porter
Owner / Operations Manager
*Beach Handyman LLC*
757handy.com
*757-354-4577*


---------- Forwarded message ---------
From: Beach Handyman LLC <hello@757handy.com>
Date: Thu, Apr 1...
2025-04-17 21:24:46,502 - CFOAgentLogger - INFO - LLM Simulation: Detected invoice creation request.
2025-04-17 21:24:46,503 - CFOAgentLogger - INFO - LLM Simulation: Extracted customer query: '638 rhode'
2025-04-17 21:24:46,504 - CFOAgentLogger - INFO - LLM Simulation: Extracted amount: None
2025-04-17 21:24:46,505 - CFOAgentLogger - INFO - LLM Simulation: Extracted estimate ID: None
2025-04-17 21:24:46,505 - CFOAgentLogger - INFO - LLM Simulation: Choosing 'search_quickbooks_context' (missing amount/estimate).
2025-04-17 21:24:46,506 - CFOAgentLogger - INFO - LLM requested tool: search_quickbooks_context with term: '638 rhode'
2025-04-17 21:24:46,507 - CFOAgentLogger - INFO - Executing tool: search_quickbooks_context for email 196467f7c958b527 with args: {'search_term': '638 rhode'}. Reply target: hello@757handy.com
2025-04-17 21:24:46,509 - CFOAgentLogger - INFO - Calling qb_api.search_quickbooks for term '638 rhode' in entities ['Customer', 'Estimate']
2025-04-17 21:24:46,510 - CFOAgentLogger - INFO - Executing broad search query for Customer: SELECT * FROM Customer WHERE Active = true AND (DisplayName LIKE '%638 rhode%' OR CompanyName LIKE '%638 rhode%' OR BillAddr.Line1 LIKE '%638 rhode%' OR ShipAddr.Line1 LIKE '%638 rhode%' OR PrimaryEmailAddr.Address LIKE '%638 rhode%') MAXRESULTS 10
2025-04-17 21:24:47,158 - CFOAgentLogger - INFO - Received new refresh token
2025-04-17 21:24:47,158 - CFOAgentLogger - INFO - Successfully refreshed QuickBooks access token
2025-04-17 21:24:48,166 - CFOAgentLogger - ERROR - QuickBooks API error: 400 - {"Fault": {"Error": [{"Message": "Error parsing query", "Detail": "QueryParserError: Encountered \"(\" \"(\" at line 1, column 48", "code": "4000"}], "type": "ValidationFault"}, "time": "2025-04-17T18:24:47.375-07:00"}
NoneType: None
2025-04-17 21:24:48,166 - CFOAgentLogger - ERROR - QuickBooks API request error: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Customer+WHERE+Active+%3D+true+AND+%28DisplayName+LIKE+%27%25638+rhode%25%27+OR+CompanyName+LIKE+%27%25638+rhode%25%27+OR+BillAddr.Line1+LIKE+%27%25638+rhode%25%27+OR+ShipAddr.Line1+LIKE+%27%25638+rhode%25%27+OR+PrimaryEmailAddr.Address+LIKE+%27%25638+rhode%25%27%29+MAXRESULTS+10
Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 137, in _make_api_request
    response.raise_for_status()
  File "C:\Users\Matt\AppData\Roaming\Python\Python312\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Customer+WHERE+Active+%3D+true+AND+%28DisplayName+LIKE+%27%25638+rhode%25%27+OR+CompanyName+LIKE+%27%25638+rhode%25%27+OR+BillAddr.Line1+LIKE+%27%25638+rhode%25%27+OR+ShipAddr.Line1+LIKE+%27%25638+rhode%25%27+OR+PrimaryEmailAddr.Address+LIKE+%27%25638+rhode%25%27%29+MAXRESULTS+10
2025-04-17 21:24:48,188 - CFOAgentLogger - ERROR - Error searching Customer for '638 rhode': 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Customer+WHERE+Active+%3D+true+AND+%28DisplayName+LIKE+%27%25638+rhode%25%27+OR+CompanyName+LIKE+%27%25638+rhode%25%27+OR+BillAddr.Line1+LIKE+%27%25638+rhode%25%27+OR+ShipAddr.Line1+LIKE+%27%25638+rhode%25%27+OR+PrimaryEmailAddr.Address+LIKE+%27%25638+rhode%25%27%29+MAXRESULTS+10
Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 792, in search_quickbooks
    response = self._make_api_request("query", params={"query": query})
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 137, in _make_api_request
    response.raise_for_status()
  File "C:\Users\Matt\AppData\Roaming\Python\Python312\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Customer+WHERE+Active+%3D+true+AND+%28DisplayName+LIKE+%27%25638+rhode%25%27+OR+CompanyName+LIKE+%27%25638+rhode%25%27+OR+BillAddr.Line1+LIKE+%27%25638+rhode%25%27+OR+ShipAddr.Line1+LIKE+%27%25638+rhode%25%27+OR+PrimaryEmailAddr.Address+LIKE+%27%25638+rhode%25%27%29+MAXRESULTS+10
2025-04-17 21:24:48,189 - CFOAgentLogger - INFO - Executing broad search query for Estimate: SELECT * FROM Estimate WHERE Active = true AND (DocNumber LIKE '%638 rhode%' OR PrivateNote LIKE '%638 rhode%') MAXRESULTS 10
2025-04-17 21:24:48,966 - CFOAgentLogger - ERROR - QuickBooks API error: 400 - {"Fault": {"Error": [{"Message": "Error parsing query", "Detail": "QueryParserError: Encountered \"(\" \"(\" at line 1, column 48", "code": "4000"}], "type": "ValidationFault"}, "time": "2025-04-17T18:24:48.149-07:00"}
NoneType: None
2025-04-17 21:24:48,966 - CFOAgentLogger - ERROR - QuickBooks API request error: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Estimate+WHERE+Active+%3D+true+AND+%28DocNumber+LIKE+%27%25638+rhode%25%27+OR+PrivateNote+LIKE+%27%25638+rhode%25%27%29+MAXRESULTS+10
Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 137, in _make_api_request
    response.raise_for_status()
  File "C:\Users\Matt\AppData\Roaming\Python\Python312\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Estimate+WHERE+Active+%3D+true+AND+%28DocNumber+LIKE+%27%25638+rhode%25%27+OR+PrivateNote+LIKE+%27%25638+rhode%25%27%29+MAXRESULTS+10
2025-04-17 21:24:48,966 - CFOAgentLogger - ERROR - Error searching Estimate for '638 rhode': 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Estimate+WHERE+Active+%3D+true+AND+%28DocNumber+LIKE+%27%25638+rhode%25%27+OR+PrivateNote+LIKE+%27%25638+rhode%25%27%29+MAXRESULTS+10
Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 792, in search_quickbooks
    response = self._make_api_request("query", params={"query": query})
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 137, in _make_api_request
    response.raise_for_status()
  File "C:\Users\Matt\AppData\Roaming\Python\Python312\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Estimate+WHERE+Active+%3D+true+AND+%28DocNumber+LIKE+%27%25638+rhode%25%27+OR+PrivateNote+LIKE+%27%25638+rhode%25%27%29+MAXRESULTS+10
2025-04-17 21:24:48,966 - CFOAgentLogger - INFO - Context search found: 0 Customer(s), 0 Estimate(s).
2025-04-17 21:24:48,966 - CFOAgentLogger - INFO - Executing tool: ask_user_for_clarification for email 196467f7c958b527 with args: {'question': "I searched QuickBooks for '638 rhode' but couldn't find a matching customer or estimate. Could you please provide more details like the customer name or estimate number?"}. Reply target: hello@757handy.com
2025-04-17 21:24:48,975 - CFOAgentLogger - INFO - Sending clarification request to hello@757handy.com: I searched QuickBooks for '638 rhode' but couldn't find a matching customer or estimate. Could you please provide more details like the customer name or estimate number?
2025-04-17 21:24:49,732 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:24:49,975 - CFOAgentLogger - INFO - Email sent to hello@757handy.com with Gmail message ID: 196467f97b00bea3
2025-04-17 21:24:49,975 - CFOAgentLogger - INFO - Clarification email sent via tool call to hello@757handy.com
2025-04-17 21:29:13,377 - CFOAgentLogger - INFO - Logger initialized successfully
2025-04-17 21:29:13,381 - CFOAgentLogger - INFO - Loaded configuration from .env
2025-04-17 21:29:13,382 - CFOAgentLogger - INFO - Configuration loaded successfully
2025-04-17 21:29:13,399 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:29:13,400 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:29:13,400 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:29:13,401 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:29:13,402 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:29:13,405 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:29:13,406 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:29:13,407 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:29:13,408 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:29:13,413 - CFOAgentLogger - INFO - Instant email checking stopped
2025-04-17 21:29:13,416 - CFOAgentLogger - INFO - Email monitoring stopped completely
2025-04-17 21:29:13,504 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:29:13,504 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:29:13,504 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:29:13,504 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:29:13,504 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:29:13,514 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:29:13,515 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:29:13,516 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:29:13,517 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:29:18,539 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:29:18,539 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:29:18,539 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:29:18,539 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:29:18,559 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:29:18,560 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:29:18,561 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:29:18,564 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:29:18,568 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:29:19,265 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:29:19,373 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:29:19,997 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:29:20,097 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:29:20,097 - CFOAgentLogger - INFO - Attempting Gmail authentication (attempt 1/3)
2025-04-17 21:29:20,858 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:29:20,858 - CFOAgentLogger - INFO - Gmail authentication successful
2025-04-17 21:29:20,862 - CFOAgentLogger - INFO - Instant email checking started (every 2.0s)
2025-04-17 21:29:20,863 - CFOAgentLogger - INFO - Instant email checking started successfully
2025-04-17 21:29:20,951 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:29:20,952 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:29:20,952 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:29:20,955 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:29:20,957 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:29:20,958 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:29:20,962 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:29:20,967 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:29:20,969 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:29:47,971 - CFOAgentLogger - INFO - Processing email from Beach Handyman LLC <hello@757handy.com> with subject: Fwd: generate invoice for 638 rhode
2025-04-17 21:29:47,971 - CFOAgentLogger - INFO - Instant processing of email: 'Fwd: generate invoice for 638 rhode' from Beach Handyman LLC <hello@757handy.com>
2025-04-17 21:29:47,971 - CFOAgentLogger - INFO - Processing new email via LLM: ID=19646841b392d932, From='Beach Handyman LLC <hello@757handy.com>', Subject='Fwd: generate invoice for 638 rhode'
2025-04-17 21:29:47,971 - CFOAgentLogger - INFO - Simulating LLM response for email body: Matt Porter
Owner / Operations Manager
*Beach Handyman LLC*
757handy.com
*757-354-4577*


---------- Forwarded message ---------
From: Beach Handyman LLC <hello@757handy.com>
Date: Thu, Apr 1...
2025-04-17 21:29:47,971 - CFOAgentLogger - INFO - LLM Simulation: Detected invoice creation request.
2025-04-17 21:29:47,971 - CFOAgentLogger - INFO - LLM Simulation: Extracted customer query: '638 rhode'
2025-04-17 21:29:47,978 - CFOAgentLogger - INFO - LLM Simulation: Extracted amount: None
2025-04-17 21:29:47,979 - CFOAgentLogger - INFO - LLM Simulation: Extracted estimate ID: None
2025-04-17 21:29:47,980 - CFOAgentLogger - INFO - LLM Simulation: Choosing 'search_quickbooks_context' (missing amount/estimate).
2025-04-17 21:29:47,981 - CFOAgentLogger - INFO - LLM requested tool: search_quickbooks_context with term: '638 rhode'
2025-04-17 21:29:47,982 - CFOAgentLogger - INFO - Executing tool: search_quickbooks_context for email 19646841b392d932 with args: {'search_term': '638 rhode'}. Reply target: hello@757handy.com
2025-04-17 21:29:47,982 - CFOAgentLogger - INFO - Calling qb_api.search_quickbooks for term '638 rhode' in entities ['Customer', 'Estimate']
2025-04-17 21:29:47,983 - CFOAgentLogger - INFO - Executing broad search query for Customer: SELECT * FROM Customer WHERE Active = true AND (DisplayName LIKE '%638 rhode%' OR CompanyName LIKE '%638 rhode%' OR BillAddr.Line1 LIKE '%638 rhode%' OR ShipAddr.Line1 LIKE '%638 rhode%' OR PrimaryEmailAddr.Address LIKE '%638 rhode%') MAXRESULTS 10
2025-04-17 21:29:48,964 - CFOAgentLogger - ERROR - QuickBooks API error: 400 - {"Fault": {"Error": [{"Message": "Error parsing query", "Detail": "QueryParserError: Encountered \"(\" \"(\" at line 1, column 48", "code": "4000"}], "type": "ValidationFault"}, "time": "2025-04-17T18:29:48.186-07:00"}
NoneType: None
2025-04-17 21:29:48,964 - CFOAgentLogger - ERROR - QuickBooks API request error: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Customer+WHERE+Active+%3D+true+AND+%28DisplayName+LIKE+%27%25638+rhode%25%27+OR+CompanyName+LIKE+%27%25638+rhode%25%27+OR+BillAddr.Line1+LIKE+%27%25638+rhode%25%27+OR+ShipAddr.Line1+LIKE+%27%25638+rhode%25%27+OR+PrimaryEmailAddr.Address+LIKE+%27%25638+rhode%25%27%29+MAXRESULTS+10
Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 137, in _make_api_request
    response.raise_for_status()
  File "C:\Users\Matt\AppData\Roaming\Python\Python312\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Customer+WHERE+Active+%3D+true+AND+%28DisplayName+LIKE+%27%25638+rhode%25%27+OR+CompanyName+LIKE+%27%25638+rhode%25%27+OR+BillAddr.Line1+LIKE+%27%25638+rhode%25%27+OR+ShipAddr.Line1+LIKE+%27%25638+rhode%25%27+OR+PrimaryEmailAddr.Address+LIKE+%27%25638+rhode%25%27%29+MAXRESULTS+10
2025-04-17 21:29:48,964 - CFOAgentLogger - ERROR - Error searching Customer for '638 rhode': 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Customer+WHERE+Active+%3D+true+AND+%28DisplayName+LIKE+%27%25638+rhode%25%27+OR+CompanyName+LIKE+%27%25638+rhode%25%27+OR+BillAddr.Line1+LIKE+%27%25638+rhode%25%27+OR+ShipAddr.Line1+LIKE+%27%25638+rhode%25%27+OR+PrimaryEmailAddr.Address+LIKE+%27%25638+rhode%25%27%29+MAXRESULTS+10
Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 792, in search_quickbooks
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 137, in _make_api_request
    response.raise_for_status()
  File "C:\Users\Matt\AppData\Roaming\Python\Python312\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Customer+WHERE+Active+%3D+true+AND+%28DisplayName+LIKE+%27%25638+rhode%25%27+OR+CompanyName+LIKE+%27%25638+rhode%25%27+OR+BillAddr.Line1+LIKE+%27%25638+rhode%25%27+OR+ShipAddr.Line1+LIKE+%27%25638+rhode%25%27+OR+PrimaryEmailAddr.Address+LIKE+%27%25638+rhode%25%27%29+MAXRESULTS+10
2025-04-17 21:29:48,982 - CFOAgentLogger - INFO - Executing broad search query for Estimate: SELECT * FROM Estimate WHERE Active = true AND (DocNumber LIKE '%638 rhode%' OR PrivateNote LIKE '%638 rhode%') MAXRESULTS 10
2025-04-17 21:29:49,697 - CFOAgentLogger - ERROR - QuickBooks API error: 400 - {"Fault": {"Error": [{"Message": "Error parsing query", "Detail": "QueryParserError: Encountered \"(\" \"(\" at line 1, column 48", "code": "4000"}], "type": "ValidationFault"}, "time": "2025-04-17T18:29:48.918-07:00"}
NoneType: None
2025-04-17 21:29:49,697 - CFOAgentLogger - ERROR - QuickBooks API request error: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Estimate+WHERE+Active+%3D+true+AND+%28DocNumber+LIKE+%27%25638+rhode%25%27+OR+PrivateNote+LIKE+%27%25638+rhode%25%27%29+MAXRESULTS+10
Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 137, in _make_api_request
    response.raise_for_status()
  File "C:\Users\Matt\AppData\Roaming\Python\Python312\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Estimate+WHERE+Active+%3D+true+AND+%28DocNumber+LIKE+%27%25638+rhode%25%27+OR+PrivateNote+LIKE+%27%25638+rhode%25%27%29+MAXRESULTS+10
2025-04-17 21:29:49,697 - CFOAgentLogger - ERROR - Error searching Estimate for '638 rhode': 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Estimate+WHERE+Active+%3D+true+AND+%28DocNumber+LIKE+%27%25638+rhode%25%27+OR+PrivateNote+LIKE+%27%25638+rhode%25%27%29+MAXRESULTS+10
Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 792, in search_quickbooks
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 137, in _make_api_request
    response.raise_for_status()
  File "C:\Users\Matt\AppData\Roaming\Python\Python312\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Estimate+WHERE+Active+%3D+true+AND+%28DocNumber+LIKE+%27%25638+rhode%25%27+OR+PrivateNote+LIKE+%27%25638+rhode%25%27%29+MAXRESULTS+10
2025-04-17 21:29:49,715 - CFOAgentLogger - INFO - Context search found: 0 Customer(s), 0 Estimate(s).
2025-04-17 21:29:49,716 - CFOAgentLogger - INFO - Executing tool: ask_user_for_clarification for email 19646841b392d932 with args: {'question': "I searched QuickBooks for '638 rhode' but couldn't find a matching customer or estimate. Could you please provide more details like the customer name or estimate number?"}. Reply target: hello@757handy.com
2025-04-17 21:29:49,717 - CFOAgentLogger - INFO - Sending clarification request to hello@757handy.com: I searched QuickBooks for '638 rhode' but couldn't find a matching customer or estimate. Could you please provide more details like the customer name or estimate number?
2025-04-17 21:29:50,464 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:29:50,645 - CFOAgentLogger - INFO - Email sent to hello@757handy.com with Gmail message ID: 19646842e0365c89
2025-04-17 21:29:50,645 - CFOAgentLogger - INFO - Clarification email sent via tool call to hello@757handy.com
2025-04-17 21:30:36,109 - CFOAgentLogger - INFO - Logger initialized successfully
2025-04-17 21:30:36,112 - CFOAgentLogger - INFO - Loaded configuration from .env
2025-04-17 21:30:36,112 - CFOAgentLogger - INFO - Configuration loaded successfully
2025-04-17 21:30:36,130 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:30:36,131 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:30:36,132 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:30:36,132 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:30:36,134 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:30:36,148 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:30:36,148 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:30:36,149 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:30:36,150 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:30:36,158 - CFOAgentLogger - INFO - Instant email checking stopped
2025-04-17 21:30:36,162 - CFOAgentLogger - INFO - Email monitoring stopped completely
2025-04-17 21:30:36,317 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:30:36,317 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:30:36,319 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:30:36,321 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:30:36,323 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:30:36,325 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:30:36,327 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:30:36,331 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:30:36,331 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:30:36,931 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:30:36,931 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:30:36,931 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:30:36,931 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:30:36,931 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:30:36,931 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:30:36,931 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:30:36,946 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:30:36,949 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:30:37,631 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:30:37,736 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:30:38,393 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:30:38,490 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:30:38,491 - CFOAgentLogger - INFO - Attempting Gmail authentication (attempt 1/3)
2025-04-17 21:30:39,197 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:30:39,197 - CFOAgentLogger - INFO - Gmail authentication successful
2025-04-17 21:30:39,197 - CFOAgentLogger - INFO - Instant email checking started (every 2.0s)
2025-04-17 21:30:39,197 - CFOAgentLogger - INFO - Instant email checking started successfully
2025-04-17 21:30:39,287 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:30:39,288 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:30:39,289 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:30:39,290 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:30:39,291 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:30:39,292 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:30:39,293 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:30:39,294 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:30:39,294 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:31:01,446 - CFOAgentLogger - INFO - Processing email from Beach Handyman LLC <hello@757handy.com> with subject: Fwd: generate invoice for 638 rhode
2025-04-17 21:31:01,446 - CFOAgentLogger - INFO - Instant processing of email: 'Fwd: generate invoice for 638 rhode' from Beach Handyman LLC <hello@757handy.com>
2025-04-17 21:31:01,446 - CFOAgentLogger - INFO - Processing new email via LLM: ID=19646853be2265b2, From='Beach Handyman LLC <hello@757handy.com>', Subject='Fwd: generate invoice for 638 rhode'
2025-04-17 21:31:01,446 - CFOAgentLogger - INFO - Simulating LLM response for email body: Matt Porter
Owner / Operations Manager
*Beach Handyman LLC*
757handy.com
*757-354-4577*


---------- Forwarded message ---------
From: Beach Handyman LLC <hello@757handy.com>
Date: Thu, Apr 1...
2025-04-17 21:31:01,446 - CFOAgentLogger - INFO - LLM Simulation: Detected invoice creation request.
2025-04-17 21:31:01,446 - CFOAgentLogger - INFO - LLM Simulation: Extracted customer query: '638 rhode'
2025-04-17 21:31:01,454 - CFOAgentLogger - INFO - LLM Simulation: Extracted amount: None
2025-04-17 21:31:01,455 - CFOAgentLogger - INFO - LLM Simulation: Extracted estimate ID: None
2025-04-17 21:31:01,455 - CFOAgentLogger - INFO - LLM Simulation: Choosing 'search_quickbooks_context' (missing amount/estimate).
2025-04-17 21:31:01,456 - CFOAgentLogger - INFO - LLM requested tool: search_quickbooks_context with term: '638 rhode'
2025-04-17 21:31:01,456 - CFOAgentLogger - INFO - Executing tool: search_quickbooks_context for email 19646853be2265b2 with args: {'search_term': '638 rhode'}. Reply target: hello@757handy.com
2025-04-17 21:31:01,457 - CFOAgentLogger - INFO - Calling qb_api.search_quickbooks for term '638 rhode' in entities ['Customer', 'Estimate']
2025-04-17 21:31:01,459 - CFOAgentLogger - INFO - Executing broad search query for Customer: SELECT * FROM Customer WHERE Active = true AND (DisplayName LIKE '%638 rhode%' OR CompanyName LIKE '%638 rhode%' OR BillAddr.Line1 LIKE '%638 rhode%' OR ShipAddr.Line1 LIKE '%638 rhode%' OR PrimaryEmailAddr.Address LIKE '%638 rhode%') MAXRESULTS 10
2025-04-17 21:31:02,213 - CFOAgentLogger - ERROR - QuickBooks API error: 400 - {"Fault": {"Error": [{"Message": "Error parsing query", "Detail": "QueryParserError: Encountered \"(\" \"(\" at line 1, column 48", "code": "4000"}], "type": "ValidationFault"}, "time": "2025-04-17T18:31:01.442-07:00"}
NoneType: None
2025-04-17 21:31:02,213 - CFOAgentLogger - ERROR - QuickBooks API request error: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Customer+WHERE+Active+%3D+true+AND+%28DisplayName+LIKE+%27%25638+rhode%25%27+OR+CompanyName+LIKE+%27%25638+rhode%25%27+OR+BillAddr.Line1+LIKE+%27%25638+rhode%25%27+OR+ShipAddr.Line1+LIKE+%27%25638+rhode%25%27+OR+PrimaryEmailAddr.Address+LIKE+%27%25638+rhode%25%27%29+MAXRESULTS+10
Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 137, in _make_api_request
    response.raise_for_status()
  File "C:\Users\Matt\AppData\Roaming\Python\Python312\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Customer+WHERE+Active+%3D+true+AND+%28DisplayName+LIKE+%27%25638+rhode%25%27+OR+CompanyName+LIKE+%27%25638+rhode%25%27+OR+BillAddr.Line1+LIKE+%27%25638+rhode%25%27+OR+ShipAddr.Line1+LIKE+%27%25638+rhode%25%27+OR+PrimaryEmailAddr.Address+LIKE+%27%25638+rhode%25%27%29+MAXRESULTS+10
2025-04-17 21:31:02,230 - CFOAgentLogger - ERROR - Error searching Customer for '638 rhode': 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Customer+WHERE+Active+%3D+true+AND+%28DisplayName+LIKE+%27%25638+rhode%25%27+OR+CompanyName+LIKE+%27%25638+rhode%25%27+OR+BillAddr.Line1+LIKE+%27%25638+rhode%25%27+OR+ShipAddr.Line1+LIKE+%27%25638+rhode%25%27+OR+PrimaryEmailAddr.Address+LIKE+%27%25638+rhode%25%27%29+MAXRESULTS+10
Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 792, in search_quickbooks
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 137, in _make_api_request
    response.raise_for_status()
  File "C:\Users\Matt\AppData\Roaming\Python\Python312\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Customer+WHERE+Active+%3D+true+AND+%28DisplayName+LIKE+%27%25638+rhode%25%27+OR+CompanyName+LIKE+%27%25638+rhode%25%27+OR+BillAddr.Line1+LIKE+%27%25638+rhode%25%27+OR+ShipAddr.Line1+LIKE+%27%25638+rhode%25%27+OR+PrimaryEmailAddr.Address+LIKE+%27%25638+rhode%25%27%29+MAXRESULTS+10
2025-04-17 21:31:02,234 - CFOAgentLogger - INFO - Executing broad search query for Estimate: SELECT * FROM Estimate WHERE Active = true AND (DocNumber LIKE '%638 rhode%' OR PrivateNote LIKE '%638 rhode%') MAXRESULTS 10
2025-04-17 21:31:02,963 - CFOAgentLogger - ERROR - QuickBooks API error: 400 - {"Fault": {"Error": [{"Message": "Error parsing query", "Detail": "QueryParserError: Encountered \"(\" \"(\" at line 1, column 48", "code": "4000"}], "type": "ValidationFault"}, "time": "2025-04-17T18:31:02.184-07:00"}
NoneType: None
2025-04-17 21:31:02,963 - CFOAgentLogger - ERROR - QuickBooks API request error: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Estimate+WHERE+Active+%3D+true+AND+%28DocNumber+LIKE+%27%25638+rhode%25%27+OR+PrivateNote+LIKE+%27%25638+rhode%25%27%29+MAXRESULTS+10
Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 137, in _make_api_request
    response.raise_for_status()
  File "C:\Users\Matt\AppData\Roaming\Python\Python312\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Estimate+WHERE+Active+%3D+true+AND+%28DocNumber+LIKE+%27%25638+rhode%25%27+OR+PrivateNote+LIKE+%27%25638+rhode%25%27%29+MAXRESULTS+10
2025-04-17 21:31:02,963 - CFOAgentLogger - ERROR - Error searching Estimate for '638 rhode': 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Estimate+WHERE+Active+%3D+true+AND+%28DocNumber+LIKE+%27%25638+rhode%25%27+OR+PrivateNote+LIKE+%27%25638+rhode%25%27%29+MAXRESULTS+10
Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 792, in search_quickbooks
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 137, in _make_api_request
    response.raise_for_status()
  File "C:\Users\Matt\AppData\Roaming\Python\Python312\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Estimate+WHERE+Active+%3D+true+AND+%28DocNumber+LIKE+%27%25638+rhode%25%27+OR+PrivateNote+LIKE+%27%25638+rhode%25%27%29+MAXRESULTS+10
2025-04-17 21:31:02,963 - CFOAgentLogger - INFO - Context search found: 0 Customer(s), 0 Estimate(s).
2025-04-17 21:31:02,976 - CFOAgentLogger - INFO - Executing tool: ask_user_for_clarification for email 19646853be2265b2 with args: {'question': "I searched QuickBooks for '638 rhode' but couldn't find a matching customer or estimate. Could you please provide more details like the customer name or estimate number?"}. Reply target: hello@757handy.com
2025-04-17 21:31:02,976 - CFOAgentLogger - INFO - Sending clarification request to hello@757handy.com: I searched QuickBooks for '638 rhode' but couldn't find a matching customer or estimate. Could you please provide more details like the customer name or estimate number?
2025-04-17 21:31:03,597 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:31:03,790 - CFOAgentLogger - INFO - Email sent to hello@757handy.com with Gmail message ID: 19646854ae83f6d1
2025-04-17 21:31:03,790 - CFOAgentLogger - INFO - Clarification email sent via tool call to hello@757handy.com
2025-04-17 21:31:21,473 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:31:21,475 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:31:21,478 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:31:21,482 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:31:21,508 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:31:21,554 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:31:21,555 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:31:21,561 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:31:21,563 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:31:21,569 - CFOAgentLogger - INFO - Instant email checking stopped
2025-04-17 21:31:21,571 - CFOAgentLogger - INFO - Email monitoring stopped completely
2025-04-17 21:31:21,716 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:31:21,717 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:31:21,742 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:31:21,756 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:31:21,758 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:31:21,759 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:31:21,763 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:31:21,765 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:31:21,767 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:31:55,132 - CFOAgentLogger - INFO - Logger initialized successfully
2025-04-17 21:31:55,136 - CFOAgentLogger - INFO - Loaded configuration from .env
2025-04-17 21:31:55,138 - CFOAgentLogger - INFO - Configuration loaded successfully
2025-04-17 21:31:55,157 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:31:55,159 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:31:55,159 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:31:55,160 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:31:55,161 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:31:55,162 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:31:55,163 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:31:55,164 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:31:55,165 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:31:56,208 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:31:56,294 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:31:57,001 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:31:57,100 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:31:57,100 - CFOAgentLogger - INFO - Attempting Gmail authentication (attempt 1/3)
2025-04-17 21:31:57,837 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:31:57,837 - CFOAgentLogger - INFO - Gmail authentication successful
2025-04-17 21:31:57,837 - CFOAgentLogger - INFO - Instant email checking started (every 2.0s)
2025-04-17 21:31:57,837 - CFOAgentLogger - INFO - Instant email checking started successfully
2025-04-17 21:31:58,063 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:31:58,063 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:31:58,063 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:31:58,063 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:31:58,063 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:31:58,063 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:31:58,063 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:31:58,063 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:31:58,063 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:32:26,260 - CFOAgentLogger - INFO - Processing email from Beach Handyman LLC <hello@757handy.com> with subject: Fwd: generate invoice for 638 rhode
2025-04-17 21:32:26,260 - CFOAgentLogger - INFO - Instant processing of email: 'Fwd: generate invoice for 638 rhode' from Beach Handyman LLC <hello@757handy.com>
2025-04-17 21:32:26,260 - CFOAgentLogger - INFO - Processing new email via LLM: ID=196468686533e845, From='Beach Handyman LLC <hello@757handy.com>', Subject='Fwd: generate invoice for 638 rhode'
2025-04-17 21:32:26,260 - CFOAgentLogger - INFO - Simulating LLM response for email body: Matt Porter
Owner / Operations Manager
*Beach Handyman LLC*
757handy.com
*757-354-4577*


---------- Forwarded message ---------
From: Beach Handyman LLC <hello@757handy.com>
Date: Thu, Apr 1...
2025-04-17 21:32:26,260 - CFOAgentLogger - INFO - LLM Simulation: Detected invoice creation request.
2025-04-17 21:32:26,260 - CFOAgentLogger - INFO - LLM Simulation: Extracted customer query: '638 rhode'
2025-04-17 21:32:26,260 - CFOAgentLogger - INFO - LLM Simulation: Extracted amount: None
2025-04-17 21:32:26,274 - CFOAgentLogger - INFO - LLM Simulation: Extracted estimate ID: None
2025-04-17 21:32:26,276 - CFOAgentLogger - INFO - LLM Simulation: Choosing 'search_quickbooks_context' (missing amount/estimate).
2025-04-17 21:32:26,279 - CFOAgentLogger - INFO - LLM requested tool: search_quickbooks_context with term: '638 rhode'
2025-04-17 21:32:26,279 - CFOAgentLogger - INFO - Executing tool: search_quickbooks_context for email 196468686533e845 with args: {'search_term': '638 rhode'}. Reply target: hello@757handy.com
2025-04-17 21:32:26,282 - CFOAgentLogger - INFO - Calling qb_api.search_quickbooks for term '638 rhode' in entities ['Customer', 'Estimate']
2025-04-17 21:32:26,283 - CFOAgentLogger - INFO - Executing refined search query for Customer: SELECT * FROM Customer WHERE Active = true AND ((DisplayName LIKE '%638%' OR CompanyName LIKE '%638%' OR BillAddr.Line1 LIKE '%638%' OR ShipAddr.Line1 LIKE '%638%' OR PrimaryEmailAddr.Address LIKE '%638%') OR (DisplayName LIKE '%rhode%' OR CompanyName LIKE '%rhode%' OR BillAddr.Line1 LIKE '%rhode%' OR ShipAddr.Line1 LIKE '%rhode%' OR PrimaryEmailAddr.Address LIKE '%rhode%')) MAXRESULTS 10
2025-04-17 21:32:26,836 - CFOAgentLogger - INFO - Received new refresh token
2025-04-17 21:32:26,837 - CFOAgentLogger - INFO - Successfully refreshed QuickBooks access token
2025-04-17 21:32:27,752 - CFOAgentLogger - ERROR - QuickBooks API error: 400 - {"Fault": {"Error": [{"Message": "Error parsing query", "Detail": "QueryParserError: Encountered \"(\" \"(\" at line 1, column 48", "code": "4000"}], "type": "ValidationFault"}, "time": "2025-04-17T18:32:26.982-07:00"}
NoneType: None
2025-04-17 21:32:27,768 - CFOAgentLogger - ERROR - QuickBooks API request error: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Customer+WHERE+Active+%3D+true+AND+%28%28DisplayName+LIKE+%27%25638%25%27+OR+CompanyName+LIKE+%27%25638%25%27+OR+BillAddr.Line1+LIKE+%27%25638%25%27+OR+ShipAddr.Line1+LIKE+%27%25638%25%27+OR+PrimaryEmailAddr.Address+LIKE+%27%25638%25%27%29+OR+%28DisplayName+LIKE+%27%25rhode%25%27+OR+CompanyName+LIKE+%27%25rhode%25%27+OR+BillAddr.Line1+LIKE+%27%25rhode%25%27+OR+ShipAddr.Line1+LIKE+%27%25rhode%25%27+OR+PrimaryEmailAddr.Address+LIKE+%27%25rhode%25%27%29%29+MAXRESULTS+10
Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 137, in _make_api_request
    response.raise_for_status()
  File "C:\Users\Matt\AppData\Roaming\Python\Python312\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Customer+WHERE+Active+%3D+true+AND+%28%28DisplayName+LIKE+%27%25638%25%27+OR+CompanyName+LIKE+%27%25638%25%27+OR+BillAddr.Line1+LIKE+%27%25638%25%27+OR+ShipAddr.Line1+LIKE+%27%25638%25%27+OR+PrimaryEmailAddr.Address+LIKE+%27%25638%25%27%29+OR+%28DisplayName+LIKE+%27%25rhode%25%27+OR+CompanyName+LIKE+%27%25rhode%25%27+OR+BillAddr.Line1+LIKE+%27%25rhode%25%27+OR+ShipAddr.Line1+LIKE+%27%25rhode%25%27+OR+PrimaryEmailAddr.Address+LIKE+%27%25rhode%25%27%29%29+MAXRESULTS+10
2025-04-17 21:32:27,768 - CFOAgentLogger - ERROR - Error searching Customer for '638 rhode': 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Customer+WHERE+Active+%3D+true+AND+%28%28DisplayName+LIKE+%27%25638%25%27+OR+CompanyName+LIKE+%27%25638%25%27+OR+BillAddr.Line1+LIKE+%27%25638%25%27+OR+ShipAddr.Line1+LIKE+%27%25638%25%27+OR+PrimaryEmailAddr.Address+LIKE+%27%25638%25%27%29+OR+%28DisplayName+LIKE+%27%25rhode%25%27+OR+CompanyName+LIKE+%27%25rhode%25%27+OR+BillAddr.Line1+LIKE+%27%25rhode%25%27+OR+ShipAddr.Line1+LIKE+%27%25rhode%25%27+OR+PrimaryEmailAddr.Address+LIKE+%27%25rhode%25%27%29%29+MAXRESULTS+10
Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 825, in search_quickbooks
    if response and f'{entity}' in response.get('QueryResponse', {}):
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 137, in _make_api_request
    response.raise_for_status()
  File "C:\Users\Matt\AppData\Roaming\Python\Python312\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Customer+WHERE+Active+%3D+true+AND+%28%28DisplayName+LIKE+%27%25638%25%27+OR+CompanyName+LIKE+%27%25638%25%27+OR+BillAddr.Line1+LIKE+%27%25638%25%27+OR+ShipAddr.Line1+LIKE+%27%25638%25%27+OR+PrimaryEmailAddr.Address+LIKE+%27%25638%25%27%29+OR+%28DisplayName+LIKE+%27%25rhode%25%27+OR+CompanyName+LIKE+%27%25rhode%25%27+OR+BillAddr.Line1+LIKE+%27%25rhode%25%27+OR+ShipAddr.Line1+LIKE+%27%25rhode%25%27+OR+PrimaryEmailAddr.Address+LIKE+%27%25rhode%25%27%29%29+MAXRESULTS+10
2025-04-17 21:32:27,774 - CFOAgentLogger - INFO - Executing refined search query for Estimate: SELECT * FROM Estimate WHERE Active = true AND ((DocNumber LIKE '%638%' OR PrivateNote LIKE '%638%') OR (DocNumber LIKE '%rhode%' OR PrivateNote LIKE '%rhode%')) MAXRESULTS 10
2025-04-17 21:32:28,242 - CFOAgentLogger - ERROR - QuickBooks API error: 400 - {"Fault": {"Error": [{"Message": "Error parsing query", "Detail": "QueryParserError: Encountered \"(\" \"(\" at line 1, column 48", "code": "4000"}], "type": "ValidationFault"}, "time": "2025-04-17T18:32:27.459-07:00"}
NoneType: None
2025-04-17 21:32:28,242 - CFOAgentLogger - ERROR - QuickBooks API request error: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Estimate+WHERE+Active+%3D+true+AND+%28%28DocNumber+LIKE+%27%25638%25%27+OR+PrivateNote+LIKE+%27%25638%25%27%29+OR+%28DocNumber+LIKE+%27%25rhode%25%27+OR+PrivateNote+LIKE+%27%25rhode%25%27%29%29+MAXRESULTS+10
Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 137, in _make_api_request
    response.raise_for_status()
  File "C:\Users\Matt\AppData\Roaming\Python\Python312\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Estimate+WHERE+Active+%3D+true+AND+%28%28DocNumber+LIKE+%27%25638%25%27+OR+PrivateNote+LIKE+%27%25638%25%27%29+OR+%28DocNumber+LIKE+%27%25rhode%25%27+OR+PrivateNote+LIKE+%27%25rhode%25%27%29%29+MAXRESULTS+10
2025-04-17 21:32:28,242 - CFOAgentLogger - ERROR - Error searching Estimate for '638 rhode': 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Estimate+WHERE+Active+%3D+true+AND+%28%28DocNumber+LIKE+%27%25638%25%27+OR+PrivateNote+LIKE+%27%25638%25%27%29+OR+%28DocNumber+LIKE+%27%25rhode%25%27+OR+PrivateNote+LIKE+%27%25rhode%25%27%29%29+MAXRESULTS+10
Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 825, in search_quickbooks
    if response and f'{entity}' in response.get('QueryResponse', {}):
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 137, in _make_api_request
    response.raise_for_status()
  File "C:\Users\Matt\AppData\Roaming\Python\Python312\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Estimate+WHERE+Active+%3D+true+AND+%28%28DocNumber+LIKE+%27%25638%25%27+OR+PrivateNote+LIKE+%27%25638%25%27%29+OR+%28DocNumber+LIKE+%27%25rhode%25%27+OR+PrivateNote+LIKE+%27%25rhode%25%27%29%29+MAXRESULTS+10
2025-04-17 21:32:28,252 - CFOAgentLogger - INFO - Context search found: 0 Customer(s), 0 Estimate(s).
2025-04-17 21:32:28,253 - CFOAgentLogger - INFO - Executing tool: ask_user_for_clarification for email 196468686533e845 with args: {'question': "I searched QuickBooks for '638 rhode' but couldn't find a matching customer or estimate. Could you please provide more details like the customer name or estimate number?"}. Reply target: hello@757handy.com
2025-04-17 21:32:28,254 - CFOAgentLogger - INFO - Sending clarification request to hello@757handy.com: I searched QuickBooks for '638 rhode' but couldn't find a matching customer or estimate. Could you please provide more details like the customer name or estimate number?
2025-04-17 21:32:28,866 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:32:29,119 - CFOAgentLogger - INFO - Email sent to hello@757handy.com with Gmail message ID: 1964686998cef0ef
2025-04-17 21:32:29,134 - CFOAgentLogger - INFO - Clarification email sent via tool call to hello@757handy.com
2025-04-17 21:33:29,725 - CFOAgentLogger - INFO - Logger initialized successfully
2025-04-17 21:33:29,725 - CFOAgentLogger - INFO - Loaded configuration from .env
2025-04-17 21:33:29,740 - CFOAgentLogger - INFO - Configuration loaded successfully
2025-04-17 21:33:29,744 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:33:29,760 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:33:29,762 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:33:29,762 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:33:29,762 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:33:29,762 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:33:29,762 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:33:29,777 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:33:29,778 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:33:29,783 - CFOAgentLogger - INFO - Instant email checking stopped
2025-04-17 21:33:29,783 - CFOAgentLogger - INFO - Email monitoring stopped completely
2025-04-17 21:33:29,885 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:33:29,887 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:33:29,888 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:33:29,888 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:33:29,889 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:33:29,891 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:33:29,891 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:33:29,892 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:33:29,893 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:33:30,470 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:33:30,470 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:33:30,470 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:33:30,470 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:33:30,470 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:33:30,480 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:33:30,484 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:33:30,485 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:33:30,487 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:33:31,129 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:33:31,224 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:33:31,879 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:33:31,986 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:33:31,986 - CFOAgentLogger - INFO - Attempting Gmail authentication (attempt 1/3)
2025-04-17 21:33:32,710 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:33:32,711 - CFOAgentLogger - INFO - Gmail authentication successful
2025-04-17 21:33:32,715 - CFOAgentLogger - INFO - Instant email checking started (every 2.0s)
2025-04-17 21:33:32,715 - CFOAgentLogger - INFO - Instant email checking started successfully
2025-04-17 21:33:32,801 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:33:32,803 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:33:32,804 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:33:32,806 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:33:32,807 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:33:32,809 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:33:32,810 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:33:32,819 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:33:32,822 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:33:56,392 - CFOAgentLogger - INFO - Logger initialized successfully
2025-04-17 21:33:56,392 - CFOAgentLogger - INFO - Loaded configuration from .env
2025-04-17 21:33:56,408 - CFOAgentLogger - INFO - Configuration loaded successfully
2025-04-17 21:33:58,452 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:33:58,453 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:33:58,453 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:33:58,454 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:33:58,454 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:33:58,455 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:33:58,456 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:33:58,456 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:33:58,457 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:34:02,449 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:34:02,449 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:34:02,449 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:34:02,449 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:34:02,449 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:34:02,449 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:34:02,449 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:34:02,449 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:34:02,449 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:34:03,097 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:34:03,196 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:34:03,863 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:34:03,955 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:34:03,957 - CFOAgentLogger - INFO - Attempting Gmail authentication (attempt 1/3)
2025-04-17 21:34:04,636 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:34:04,637 - CFOAgentLogger - INFO - Gmail authentication successful
2025-04-17 21:34:04,641 - CFOAgentLogger - INFO - Instant email checking started (every 2.0s)
2025-04-17 21:34:04,642 - CFOAgentLogger - INFO - Instant email checking started successfully
2025-04-17 21:34:04,725 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:34:04,726 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:34:04,727 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:34:04,728 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:34:04,729 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:34:04,730 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:34:04,731 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:34:04,732 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:34:04,733 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:34:28,102 - CFOAgentLogger - INFO - Processing email from Beach Handyman LLC <hello@757handy.com> with subject: Fwd: generate invoice for 638 rhode
2025-04-17 21:34:28,102 - CFOAgentLogger - INFO - Instant processing of email: 'Fwd: generate invoice for 638 rhode' from Beach Handyman LLC <hello@757handy.com>
2025-04-17 21:34:28,102 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:34:28,102 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:34:28,118 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:34:28,119 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:34:28,119 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:34:28,127 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:34:28,127 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:34:28,127 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:34:28,127 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:34:28,162 - CFOAgentLogger - INFO - Processing new email via LLM: ID=19646885decca830, From='Beach Handyman LLC <hello@757handy.com>', Subject='Fwd: generate invoice for 638 rhode'
2025-04-17 21:34:28,162 - CFOAgentLogger - INFO - Simulating LLM response for email body: Matt Porter
Owner / Operations Manager
*Beach Handyman LLC*
757handy.com
*757-354-4577*


---------- Forwarded message ---------
From: Beach Handyman LLC <hello@757handy.com>
Date: Thu, Apr 1...
2025-04-17 21:34:28,162 - CFOAgentLogger - INFO - LLM Simulation: Detected invoice creation request.
2025-04-17 21:34:28,162 - CFOAgentLogger - INFO - LLM Simulation: Extracted customer query: '638 rhode'
2025-04-17 21:34:28,173 - CFOAgentLogger - INFO - LLM Simulation: Extracted amount: None
2025-04-17 21:34:28,174 - CFOAgentLogger - INFO - LLM Simulation: Extracted estimate ID: None
2025-04-17 21:34:28,175 - CFOAgentLogger - INFO - LLM Simulation: Choosing 'search_quickbooks_context' (missing amount/estimate).
2025-04-17 21:34:28,175 - CFOAgentLogger - INFO - LLM requested tool: search_quickbooks_context with term: '638 rhode'
2025-04-17 21:34:28,175 - CFOAgentLogger - INFO - Executing tool: search_quickbooks_context for email 19646885decca830 with args: {'search_term': '638 rhode'}. Reply target: hello@757handy.com
2025-04-17 21:34:28,176 - CFOAgentLogger - INFO - Calling qb_api.search_quickbooks for term '638 rhode' in entities ['Customer', 'Estimate']
2025-04-17 21:34:28,178 - CFOAgentLogger - INFO - Executing flattened search query for Customer: SELECT * FROM Customer WHERE DisplayName LIKE '%638%' OR CompanyName LIKE '%638%' OR BillAddr.Line1 LIKE '%638%' OR ShipAddr.Line1 LIKE '%638%' OR PrimaryEmailAddr.Address LIKE '%638%' OR DisplayName LIKE '%rhode%' OR CompanyName LIKE '%rhode%' OR BillAddr.Line1 LIKE '%rhode%' OR ShipAddr.Line1 LIKE '%rhode%' OR PrimaryEmailAddr.Address LIKE '%rhode%' MAXRESULTS 20
2025-04-17 21:34:28,746 - CFOAgentLogger - INFO - Received new refresh token
2025-04-17 21:34:28,746 - CFOAgentLogger - INFO - Successfully refreshed QuickBooks access token
2025-04-17 21:34:29,496 - CFOAgentLogger - ERROR - QuickBooks API error: 400 - {"Fault": {"Error": [{"Message": "Error parsing query", "Detail": "QueryParserError: Encountered <OR> \"OR\" at line 1, column 55", "code": "4000"}], "type": "ValidationFault"}, "time": "2025-04-17T18:34:28.715-07:00"}
NoneType: None
2025-04-17 21:34:29,496 - CFOAgentLogger - ERROR - QuickBooks API request error: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Customer+WHERE+DisplayName+LIKE+%27%25638%25%27+OR+CompanyName+LIKE+%27%25638%25%27+OR+BillAddr.Line1+LIKE+%27%25638%25%27+OR+ShipAddr.Line1+LIKE+%27%25638%25%27+OR+PrimaryEmailAddr.Address+LIKE+%27%25638%25%27+OR+DisplayName+LIKE+%27%25rhode%25%27+OR+CompanyName+LIKE+%27%25rhode%25%27+OR+BillAddr.Line1+LIKE+%27%25rhode%25%27+OR+ShipAddr.Line1+LIKE+%27%25rhode%25%27+OR+PrimaryEmailAddr.Address+LIKE+%27%25rhode%25%27+MAXRESULTS+20
Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 137, in _make_api_request
    response.raise_for_status()
  File "C:\Users\Matt\AppData\Roaming\Python\Python312\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Customer+WHERE+DisplayName+LIKE+%27%25638%25%27+OR+CompanyName+LIKE+%27%25638%25%27+OR+BillAddr.Line1+LIKE+%27%25638%25%27+OR+ShipAddr.Line1+LIKE+%27%25638%25%27+OR+PrimaryEmailAddr.Address+LIKE+%27%25638%25%27+OR+DisplayName+LIKE+%27%25rhode%25%27+OR+CompanyName+LIKE+%27%25rhode%25%27+OR+BillAddr.Line1+LIKE+%27%25rhode%25%27+OR+ShipAddr.Line1+LIKE+%27%25rhode%25%27+OR+PrimaryEmailAddr.Address+LIKE+%27%25rhode%25%27+MAXRESULTS+20
2025-04-17 21:34:29,496 - CFOAgentLogger - ERROR - QuickBooks query error searching Customer for '638 rhode': {"Fault": {"Error": [{"Message": "Error parsing query", "Detail": "QueryParserError: Encountered <OR> \"OR\" at line 1, column 55", "code": "4000"}], "type": "ValidationFault"}, "time": "2025-04-17T18:34:28.715-07:00"}
2025-04-17 21:34:29,496 - CFOAgentLogger - INFO - Executing flattened search query for Estimate: SELECT * FROM Estimate WHERE DocNumber LIKE '%638%' OR PrivateNote LIKE '%638%' OR DocNumber LIKE '%rhode%' OR PrivateNote LIKE '%rhode%' MAXRESULTS 20
2025-04-17 21:34:30,262 - CFOAgentLogger - ERROR - QuickBooks API error: 400 - {"Fault": {"Error": [{"Message": "Error parsing query", "Detail": "QueryParserError: Encountered <OR> \"OR\" at line 1, column 53", "code": "4000"}], "type": "ValidationFault"}, "time": "2025-04-17T18:34:29.486-07:00"}
NoneType: None
2025-04-17 21:34:30,262 - CFOAgentLogger - ERROR - QuickBooks API request error: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Estimate+WHERE+DocNumber+LIKE+%27%25638%25%27+OR+PrivateNote+LIKE+%27%25638%25%27+OR+DocNumber+LIKE+%27%25rhode%25%27+OR+PrivateNote+LIKE+%27%25rhode%25%27+MAXRESULTS+20
Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 137, in _make_api_request
    response.raise_for_status()
  File "C:\Users\Matt\AppData\Roaming\Python\Python312\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Estimate+WHERE+DocNumber+LIKE+%27%25638%25%27+OR+PrivateNote+LIKE+%27%25638%25%27+OR+DocNumber+LIKE+%27%25rhode%25%27+OR+PrivateNote+LIKE+%27%25rhode%25%27+MAXRESULTS+20
2025-04-17 21:34:30,278 - CFOAgentLogger - ERROR - QuickBooks query error searching Estimate for '638 rhode': {"Fault": {"Error": [{"Message": "Error parsing query", "Detail": "QueryParserError: Encountered <OR> \"OR\" at line 1, column 53", "code": "4000"}], "type": "ValidationFault"}, "time": "2025-04-17T18:34:29.486-07:00"}
2025-04-17 21:34:30,278 - CFOAgentLogger - INFO - Context search found: 0 Customer(s), 0 Estimate(s).
2025-04-17 21:34:30,278 - CFOAgentLogger - INFO - Executing tool: ask_user_for_clarification for email 19646885decca830 with args: {'question': "I searched QuickBooks for '638 rhode' but couldn't find a matching customer or estimate. Could you please provide more details like the customer name or estimate number?"}. Reply target: hello@757handy.com
2025-04-17 21:34:30,278 - CFOAgentLogger - INFO - Sending clarification request to hello@757handy.com: I searched QuickBooks for '638 rhode' but couldn't find a matching customer or estimate. Could you please provide more details like the customer name or estimate number?
2025-04-17 21:34:30,912 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:34:31,090 - CFOAgentLogger - INFO - Email sent to hello@757handy.com with Gmail message ID: 196468874c835935
2025-04-17 21:34:31,090 - CFOAgentLogger - INFO - Clarification email sent via tool call to hello@757handy.com
2025-04-17 21:42:22,045 - CFOAgentLogger - INFO - Logger initialized successfully
2025-04-17 21:42:22,049 - CFOAgentLogger - INFO - Loaded configuration from .env
2025-04-17 21:42:22,050 - CFOAgentLogger - INFO - Configuration loaded successfully
2025-04-17 21:42:22,069 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:42:22,070 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:42:22,071 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:42:22,071 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:42:22,072 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:42:22,073 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:42:22,076 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:42:22,077 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:42:22,078 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:42:22,082 - CFOAgentLogger - INFO - Instant email checking stopped
2025-04-17 21:42:22,082 - CFOAgentLogger - INFO - Email monitoring stopped completely
2025-04-17 21:42:22,186 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:42:22,187 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:42:22,188 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:42:22,189 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:42:22,190 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:42:22,193 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:42:22,194 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:42:22,195 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:42:22,196 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:42:29,459 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:42:29,460 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:42:29,461 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:42:29,464 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:42:29,466 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:42:29,467 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:42:29,468 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:42:29,469 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:42:29,470 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:42:30,192 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:42:30,304 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:42:30,976 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:42:31,088 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:42:31,088 - CFOAgentLogger - INFO - Attempting Gmail authentication (attempt 1/3)
2025-04-17 21:42:31,759 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:42:31,759 - CFOAgentLogger - INFO - Gmail authentication successful
2025-04-17 21:42:31,759 - CFOAgentLogger - INFO - Instant email checking started (every 2.0s)
2025-04-17 21:42:31,759 - CFOAgentLogger - INFO - Instant email checking started successfully
2025-04-17 21:42:31,883 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:42:31,895 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:42:31,909 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:42:31,917 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:42:31,919 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:42:31,926 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:42:31,938 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:42:31,949 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:42:31,950 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:42:56,792 - CFOAgentLogger - INFO - Processing email from Beach Handyman LLC <hello@757handy.com> with subject: Fwd: generate invoice for 638 rhode
2025-04-17 21:42:56,792 - CFOAgentLogger - INFO - Instant processing of email: 'Fwd: generate invoice for 638 rhode' from Beach Handyman LLC <hello@757handy.com>
2025-04-17 21:42:56,792 - CFOAgentLogger - INFO - Processing new email via LLM: ID=196469021fbd445d, From='Beach Handyman LLC <hello@757handy.com>', Subject='Fwd: generate invoice for 638 rhode'
2025-04-17 21:42:56,792 - CFOAgentLogger - INFO - Simulating LLM response for email body: Matt Porter
Owner / Operations Manager
*Beach Handyman LLC*
757handy.com
*757-354-4577*


---------- Forwarded message ---------
From: Beach Handyman LLC <hello@757handy.com>
Date: Thu, Apr 1...
2025-04-17 21:42:56,792 - CFOAgentLogger - INFO - LLM Simulation: Detected invoice creation request.
2025-04-17 21:42:56,792 - CFOAgentLogger - INFO - LLM Simulation: Extracted customer query: '638 rhode'
2025-04-17 21:42:56,792 - CFOAgentLogger - INFO - LLM Simulation: Extracted amount: None
2025-04-17 21:42:56,806 - CFOAgentLogger - INFO - LLM Simulation: Extracted estimate ID: None
2025-04-17 21:42:56,807 - CFOAgentLogger - INFO - LLM Simulation: Choosing 'search_quickbooks_context' (missing amount/estimate).
2025-04-17 21:42:56,808 - CFOAgentLogger - INFO - LLM requested tool: search_quickbooks_context with term: '638 rhode'
2025-04-17 21:42:56,809 - CFOAgentLogger - INFO - Executing tool: search_quickbooks_context for email 196469021fbd445d with args: {'search_term': '638 rhode'}. Reply target: hello@757handy.com
2025-04-17 21:42:56,810 - CFOAgentLogger - INFO - Calling qb_api.search_quickbooks for term '638 rhode' in entities ['Customer', 'Estimate']
2025-04-17 21:42:56,812 - CFOAgentLogger - INFO - Executing flattened search query for Customer: SELECT * FROM Customer WHERE DisplayName LIKE '%638%' OR CompanyName LIKE '%638%' OR BillAddr.Line1 LIKE '%638%' OR ShipAddr.Line1 LIKE '%638%' OR PrimaryEmailAddr.Address LIKE '%638%' OR DisplayName LIKE '%rhode%' OR CompanyName LIKE '%rhode%' OR BillAddr.Line1 LIKE '%rhode%' OR ShipAddr.Line1 LIKE '%rhode%' OR PrimaryEmailAddr.Address LIKE '%rhode%' MAXRESULTS 20
2025-04-17 21:42:57,942 - CFOAgentLogger - ERROR - QuickBooks API error: 400 - {"Fault": {"Error": [{"Message": "Error parsing query", "Detail": "QueryParserError: Encountered <OR> \"OR\" at line 1, column 55", "code": "4000"}], "type": "ValidationFault"}, "time": "2025-04-17T18:42:57.113-07:00"}
NoneType: None
2025-04-17 21:42:57,942 - CFOAgentLogger - ERROR - QuickBooks API request error: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Customer+WHERE+DisplayName+LIKE+%27%25638%25%27+OR+CompanyName+LIKE+%27%25638%25%27+OR+BillAddr.Line1+LIKE+%27%25638%25%27+OR+ShipAddr.Line1+LIKE+%27%25638%25%27+OR+PrimaryEmailAddr.Address+LIKE+%27%25638%25%27+OR+DisplayName+LIKE+%27%25rhode%25%27+OR+CompanyName+LIKE+%27%25rhode%25%27+OR+BillAddr.Line1+LIKE+%27%25rhode%25%27+OR+ShipAddr.Line1+LIKE+%27%25rhode%25%27+OR+PrimaryEmailAddr.Address+LIKE+%27%25rhode%25%27+MAXRESULTS+20
Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 137, in _make_api_request
    response.raise_for_status()
  File "C:\Users\Matt\AppData\Roaming\Python\Python312\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Customer+WHERE+DisplayName+LIKE+%27%25638%25%27+OR+CompanyName+LIKE+%27%25638%25%27+OR+BillAddr.Line1+LIKE+%27%25638%25%27+OR+ShipAddr.Line1+LIKE+%27%25638%25%27+OR+PrimaryEmailAddr.Address+LIKE+%27%25638%25%27+OR+DisplayName+LIKE+%27%25rhode%25%27+OR+CompanyName+LIKE+%27%25rhode%25%27+OR+BillAddr.Line1+LIKE+%27%25rhode%25%27+OR+ShipAddr.Line1+LIKE+%27%25rhode%25%27+OR+PrimaryEmailAddr.Address+LIKE+%27%25rhode%25%27+MAXRESULTS+20
2025-04-17 21:42:57,942 - CFOAgentLogger - ERROR - QuickBooks query error searching Customer for '638 rhode': {"Fault": {"Error": [{"Message": "Error parsing query", "Detail": "QueryParserError: Encountered <OR> \"OR\" at line 1, column 55", "code": "4000"}], "type": "ValidationFault"}, "time": "2025-04-17T18:42:57.113-07:00"}
2025-04-17 21:42:57,942 - CFOAgentLogger - INFO - Executing flattened search query for Estimate: SELECT * FROM Estimate WHERE DocNumber LIKE '%638%' OR PrivateNote LIKE '%638%' OR DocNumber LIKE '%rhode%' OR PrivateNote LIKE '%rhode%' MAXRESULTS 20
2025-04-17 21:42:58,642 - CFOAgentLogger - ERROR - QuickBooks API error: 400 - {"Fault": {"Error": [{"Message": "Error parsing query", "Detail": "QueryParserError: Encountered <OR> \"OR\" at line 1, column 53", "code": "4000"}], "type": "ValidationFault"}, "time": "2025-04-17T18:42:57.809-07:00"}
NoneType: None
2025-04-17 21:42:58,642 - CFOAgentLogger - ERROR - QuickBooks API request error: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Estimate+WHERE+DocNumber+LIKE+%27%25638%25%27+OR+PrivateNote+LIKE+%27%25638%25%27+OR+DocNumber+LIKE+%27%25rhode%25%27+OR+PrivateNote+LIKE+%27%25rhode%25%27+MAXRESULTS+20
Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 137, in _make_api_request
    response.raise_for_status()
  File "C:\Users\Matt\AppData\Roaming\Python\Python312\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Estimate+WHERE+DocNumber+LIKE+%27%25638%25%27+OR+PrivateNote+LIKE+%27%25638%25%27+OR+DocNumber+LIKE+%27%25rhode%25%27+OR+PrivateNote+LIKE+%27%25rhode%25%27+MAXRESULTS+20
2025-04-17 21:42:58,642 - CFOAgentLogger - ERROR - QuickBooks query error searching Estimate for '638 rhode': {"Fault": {"Error": [{"Message": "Error parsing query", "Detail": "QueryParserError: Encountered <OR> \"OR\" at line 1, column 53", "code": "4000"}], "type": "ValidationFault"}, "time": "2025-04-17T18:42:57.809-07:00"}
2025-04-17 21:42:58,642 - CFOAgentLogger - INFO - Context search found: 0 Customer(s), 0 Estimate(s).
2025-04-17 21:42:58,642 - CFOAgentLogger - INFO - Executing tool: ask_user_for_clarification for email 196469021fbd445d with args: {'question': "I searched QuickBooks for '638 rhode' but couldn't find a matching customer or estimate. Could you please provide more details like the customer name or estimate number?"}. Reply target: hello@757handy.com
2025-04-17 21:42:58,642 - CFOAgentLogger - INFO - Sending clarification request to hello@757handy.com: I searched QuickBooks for '638 rhode' but couldn't find a matching customer or estimate. Could you please provide more details like the customer name or estimate number?
2025-04-17 21:42:59,276 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:42:59,471 - CFOAgentLogger - INFO - Email sent to hello@757handy.com with Gmail message ID: 1964690363e301d8
2025-04-17 21:42:59,471 - CFOAgentLogger - INFO - Clarification email sent via tool call to hello@757handy.com
2025-04-17 21:45:04,104 - CFOAgentLogger - INFO - Logger initialized successfully
2025-04-17 21:45:04,108 - CFOAgentLogger - INFO - Loaded configuration from .env
2025-04-17 21:45:04,109 - CFOAgentLogger - INFO - Configuration loaded successfully
2025-04-17 21:45:06,046 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:45:06,047 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:45:06,047 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:45:06,048 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:45:06,048 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:45:06,049 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:45:06,050 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:45:06,050 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:45:06,051 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:45:09,986 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:45:09,986 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:45:09,992 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:45:09,993 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:45:09,994 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:45:09,995 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:45:09,996 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:45:10,002 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:45:10,002 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:45:10,708 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:45:10,819 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:45:11,492 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:45:11,577 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:45:11,578 - CFOAgentLogger - INFO - Attempting Gmail authentication (attempt 1/3)
2025-04-17 21:45:12,248 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:45:12,248 - CFOAgentLogger - INFO - Gmail authentication successful
2025-04-17 21:45:12,248 - CFOAgentLogger - INFO - Instant email checking started (every 2.0s)
2025-04-17 21:45:12,248 - CFOAgentLogger - INFO - Instant email checking started successfully
2025-04-17 21:45:12,347 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:45:12,348 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:45:12,349 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:45:12,349 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:45:12,350 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:45:12,352 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:45:12,353 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:45:12,354 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:45:12,355 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:45:35,681 - CFOAgentLogger - INFO - Processing email from Beach Handyman LLC <hello@757handy.com> with subject: Fwd: generate invoice for 638 rhode
2025-04-17 21:45:35,681 - CFOAgentLogger - INFO - Instant processing of email: 'Fwd: generate invoice for 638 rhode' from Beach Handyman LLC <hello@757handy.com>
2025-04-17 21:45:35,681 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:45:35,681 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:45:35,681 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:45:35,695 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:45:35,699 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:45:35,713 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:45:35,714 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:45:35,714 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:45:35,715 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:45:35,777 - CFOAgentLogger - INFO - Processing new email via LLM: ID=19646928fb2d5602, From='Beach Handyman LLC <hello@757handy.com>', Subject='Fwd: generate invoice for 638 rhode'
2025-04-17 21:45:35,778 - CFOAgentLogger - INFO - Simulating LLM response for email body: Matt Porter
Owner / Operations Manager
*Beach Handyman LLC*
757handy.com
*757-354-4577*


---------- Forwarded message ---------
From: Beach Handyman LLC <hello@757handy.com>
Date: Thu, Apr 1...
2025-04-17 21:45:35,780 - CFOAgentLogger - INFO - LLM Simulation: Detected invoice creation request.
2025-04-17 21:45:35,782 - CFOAgentLogger - INFO - LLM Simulation: Extracted customer query: '638 rhode'
2025-04-17 21:45:35,786 - CFOAgentLogger - INFO - LLM Simulation: Extracted amount: None
2025-04-17 21:45:35,787 - CFOAgentLogger - INFO - LLM Simulation: Extracted estimate ID: None
2025-04-17 21:45:35,788 - CFOAgentLogger - INFO - LLM Simulation: Choosing 'search_quickbooks_context' (missing amount/estimate).
2025-04-17 21:45:35,789 - CFOAgentLogger - INFO - LLM requested tool: search_quickbooks_context with term: '638 rhode'
2025-04-17 21:45:35,790 - CFOAgentLogger - INFO - Executing tool: search_quickbooks_context for email 19646928fb2d5602 with args: {'search_term': '638 rhode'}. Reply target: hello@757handy.com
2025-04-17 21:45:35,792 - CFOAgentLogger - INFO - Calling qb_api.search_quickbooks for term '638 rhode' in entities ['Customer', 'Estimate']
2025-04-17 21:45:35,793 - CFOAgentLogger - INFO - Executing query for word '638' in Customer: SELECT * FROM Customer WHERE DisplayName LIKE '%638%' OR CompanyName LIKE '%638%' OR BillAddr.Line1 LIKE '%638%' OR ShipAddr.Line1 LIKE '%638%' OR PrimaryEmailAddr.Address LIKE '%638%' MAXRESULTS 50
2025-04-17 21:45:36,341 - CFOAgentLogger - INFO - Received new refresh token
2025-04-17 21:45:36,341 - CFOAgentLogger - INFO - Successfully refreshed QuickBooks access token
2025-04-17 21:45:37,309 - CFOAgentLogger - ERROR - QuickBooks API error: 400 - {"Fault": {"Error": [{"Message": "Error parsing query", "Detail": "QueryParserError: Encountered <OR> \"OR\" at line 1, column 55", "code": "4000"}], "type": "ValidationFault"}, "time": "2025-04-17T18:45:36.543-07:00"}
NoneType: None
2025-04-17 21:45:37,309 - CFOAgentLogger - ERROR - QuickBooks API request error: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Customer+WHERE+DisplayName+LIKE+%27%25638%25%27+OR+CompanyName+LIKE+%27%25638%25%27+OR+BillAddr.Line1+LIKE+%27%25638%25%27+OR+ShipAddr.Line1+LIKE+%27%25638%25%27+OR+PrimaryEmailAddr.Address+LIKE+%27%25638%25%27+MAXRESULTS+50
Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 137, in _make_api_request
    response.raise_for_status()
  File "C:\Users\Matt\AppData\Roaming\Python\Python312\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Customer+WHERE+DisplayName+LIKE+%27%25638%25%27+OR+CompanyName+LIKE+%27%25638%25%27+OR+BillAddr.Line1+LIKE+%27%25638%25%27+OR+ShipAddr.Line1+LIKE+%27%25638%25%27+OR+PrimaryEmailAddr.Address+LIKE+%27%25638%25%27+MAXRESULTS+50
2025-04-17 21:45:37,309 - CFOAgentLogger - ERROR - QB query error searching Customer for word '638': {'Fault': {'Error': [{'Message': 'Error parsing query', 'Detail': 'QueryParserError: Encountered <OR> "OR" at line 1, column 55', 'code': '4000'}], 'type': 'ValidationFault'}, 'time': '2025-04-17T18:45:36.543-07:00'}
2025-04-17 21:45:37,309 - CFOAgentLogger - INFO - Executing query for word 'rhode' in Customer: SELECT * FROM Customer WHERE DisplayName LIKE '%rhode%' OR CompanyName LIKE '%rhode%' OR BillAddr.Line1 LIKE '%rhode%' OR ShipAddr.Line1 LIKE '%rhode%' OR PrimaryEmailAddr.Address LIKE '%rhode%' MAXRESULTS 50
2025-04-17 21:45:38,050 - CFOAgentLogger - ERROR - QuickBooks API error: 400 - {"Fault": {"Error": [{"Message": "Error parsing query", "Detail": "QueryParserError: Encountered <OR> \"OR\" at line 1, column 57", "code": "4000"}], "type": "ValidationFault"}, "time": "2025-04-17T18:45:37.217-07:00"}
NoneType: None
2025-04-17 21:45:38,052 - CFOAgentLogger - ERROR - QuickBooks API request error: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Customer+WHERE+DisplayName+LIKE+%27%25rhode%25%27+OR+CompanyName+LIKE+%27%25rhode%25%27+OR+BillAddr.Line1+LIKE+%27%25rhode%25%27+OR+ShipAddr.Line1+LIKE+%27%25rhode%25%27+OR+PrimaryEmailAddr.Address+LIKE+%27%25rhode%25%27+MAXRESULTS+50
Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 137, in _make_api_request
    response.raise_for_status()
  File "C:\Users\Matt\AppData\Roaming\Python\Python312\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Customer+WHERE+DisplayName+LIKE+%27%25rhode%25%27+OR+CompanyName+LIKE+%27%25rhode%25%27+OR+BillAddr.Line1+LIKE+%27%25rhode%25%27+OR+ShipAddr.Line1+LIKE+%27%25rhode%25%27+OR+PrimaryEmailAddr.Address+LIKE+%27%25rhode%25%27+MAXRESULTS+50
2025-04-17 21:45:38,052 - CFOAgentLogger - ERROR - QB query error searching Customer for word 'rhode': {'Fault': {'Error': [{'Message': 'Error parsing query', 'Detail': 'QueryParserError: Encountered <OR> "OR" at line 1, column 57', 'code': '4000'}], 'type': 'ValidationFault'}, 'time': '2025-04-17T18:45:37.217-07:00'}
2025-04-17 21:45:38,052 - CFOAgentLogger - INFO - Executing query for word '638' in Estimate: SELECT * FROM Estimate WHERE DocNumber LIKE '%638%' OR PrivateNote LIKE '%638%' MAXRESULTS 50
2025-04-17 21:45:38,742 - CFOAgentLogger - ERROR - QuickBooks API error: 400 - {"Fault": {"Error": [{"Message": "Error parsing query", "Detail": "QueryParserError: Encountered <OR> \"OR\" at line 1, column 53", "code": "4000"}], "type": "ValidationFault"}, "time": "2025-04-17T18:45:37.919-07:00"}
NoneType: None
2025-04-17 21:45:38,742 - CFOAgentLogger - ERROR - QuickBooks API request error: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Estimate+WHERE+DocNumber+LIKE+%27%25638%25%27+OR+PrivateNote+LIKE+%27%25638%25%27+MAXRESULTS+50
Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 137, in _make_api_request
    response.raise_for_status()
  File "C:\Users\Matt\AppData\Roaming\Python\Python312\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Estimate+WHERE+DocNumber+LIKE+%27%25638%25%27+OR+PrivateNote+LIKE+%27%25638%25%27+MAXRESULTS+50
2025-04-17 21:45:38,742 - CFOAgentLogger - ERROR - QB query error searching Estimate for word '638': {'Fault': {'Error': [{'Message': 'Error parsing query', 'Detail': 'QueryParserError: Encountered <OR> "OR" at line 1, column 53', 'code': '4000'}], 'type': 'ValidationFault'}, 'time': '2025-04-17T18:45:37.919-07:00'}
2025-04-17 21:45:38,758 - CFOAgentLogger - INFO - Executing query for word 'rhode' in Estimate: SELECT * FROM Estimate WHERE DocNumber LIKE '%rhode%' OR PrivateNote LIKE '%rhode%' MAXRESULTS 50
2025-04-17 21:45:39,491 - CFOAgentLogger - ERROR - QuickBooks API error: 400 - {"Fault": {"Error": [{"Message": "Error parsing query", "Detail": "QueryParserError: Encountered <OR> \"OR\" at line 1, column 55", "code": "4000"}], "type": "ValidationFault"}, "time": "2025-04-17T18:45:38.729-07:00"}
NoneType: None
2025-04-17 21:45:39,491 - CFOAgentLogger - ERROR - QuickBooks API request error: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Estimate+WHERE+DocNumber+LIKE+%27%25rhode%25%27+OR+PrivateNote+LIKE+%27%25rhode%25%27+MAXRESULTS+50
Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 137, in _make_api_request
    response.raise_for_status()
  File "C:\Users\Matt\AppData\Roaming\Python\Python312\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Estimate+WHERE+DocNumber+LIKE+%27%25rhode%25%27+OR+PrivateNote+LIKE+%27%25rhode%25%27+MAXRESULTS+50
2025-04-17 21:45:39,491 - CFOAgentLogger - ERROR - QB query error searching Estimate for word 'rhode': {'Fault': {'Error': [{'Message': 'Error parsing query', 'Detail': 'QueryParserError: Encountered <OR> "OR" at line 1, column 55', 'code': '4000'}], 'type': 'ValidationFault'}, 'time': '2025-04-17T18:45:38.729-07:00'}
2025-04-17 21:45:39,491 - CFOAgentLogger - INFO - Total unique Customer records found across all words: 0
2025-04-17 21:45:39,491 - CFOAgentLogger - INFO - Kept 0 active Customer records.
2025-04-17 21:45:39,491 - CFOAgentLogger - INFO - Total unique Estimate records found across all words: 0
2025-04-17 21:45:39,507 - CFOAgentLogger - INFO - Kept 0 active Estimate records.
2025-04-17 21:45:39,508 - CFOAgentLogger - INFO - Context search found: 0 Customer(s), 0 Estimate(s).
2025-04-17 21:45:39,508 - CFOAgentLogger - INFO - Executing tool: ask_user_for_clarification for email 19646928fb2d5602 with args: {'question': "I searched QuickBooks for '638 rhode' but couldn't find a matching customer or estimate. Could you please provide more details like the customer name or estimate number?"}. Reply target: hello@757handy.com
2025-04-17 21:45:39,509 - CFOAgentLogger - INFO - Sending clarification request to hello@757handy.com: I searched QuickBooks for '638 rhode' but couldn't find a matching customer or estimate. Could you please provide more details like the customer name or estimate number?
2025-04-17 21:45:40,225 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:45:40,493 - CFOAgentLogger - INFO - Email sent to hello@757handy.com with Gmail message ID: 1964692ad17e1555
2025-04-17 21:45:40,493 - CFOAgentLogger - INFO - Clarification email sent via tool call to hello@757handy.com
2025-04-17 21:46:53,630 - CFOAgentLogger - INFO - Processing email from Beach Handyman LLC <hello@757handy.com> with subject: Fwd: generate invoice for 638 rhode
2025-04-17 21:46:53,630 - CFOAgentLogger - INFO - Instant processing of email: 'Fwd: generate invoice for 638 rhode' from Beach Handyman LLC <hello@757handy.com>
2025-04-17 21:46:53,646 - CFOAgentLogger - INFO - Processing new email via LLM: ID=1964693c06e1170b, From='Beach Handyman LLC <hello@757handy.com>', Subject='Fwd: generate invoice for 638 rhode'
2025-04-17 21:46:53,646 - CFOAgentLogger - INFO - Simulating LLM response for email body: Matt Porter
Owner / Operations Manager
*Beach Handyman LLC*
757handy.com
*757-354-4577*


---------- Forwarded message ---------
From: Beach Handyman LLC <hello@757handy.com>
Date: Thu, Apr 1...
2025-04-17 21:46:53,646 - CFOAgentLogger - INFO - LLM Simulation: Detected invoice creation request.
2025-04-17 21:46:53,646 - CFOAgentLogger - INFO - LLM Simulation: Extracted customer query: '638 rhode'
2025-04-17 21:46:53,646 - CFOAgentLogger - INFO - LLM Simulation: Extracted amount: None
2025-04-17 21:46:53,674 - CFOAgentLogger - INFO - LLM Simulation: Extracted estimate ID: None
2025-04-17 21:46:53,676 - CFOAgentLogger - INFO - LLM Simulation: Choosing 'search_quickbooks_context' (missing amount/estimate).
2025-04-17 21:46:53,678 - CFOAgentLogger - INFO - LLM requested tool: search_quickbooks_context with term: '638 rhode'
2025-04-17 21:46:53,679 - CFOAgentLogger - INFO - Executing tool: search_quickbooks_context for email 1964693c06e1170b with args: {'search_term': '638 rhode'}. Reply target: hello@757handy.com
2025-04-17 21:46:53,682 - CFOAgentLogger - INFO - Calling qb_api.search_quickbooks for term '638 rhode' in entities ['Customer', 'Estimate']
2025-04-17 21:46:53,682 - CFOAgentLogger - INFO - Executing query for word '638' in Customer: SELECT * FROM Customer WHERE DisplayName LIKE '%638%' OR CompanyName LIKE '%638%' OR BillAddr.Line1 LIKE '%638%' OR ShipAddr.Line1 LIKE '%638%' OR PrimaryEmailAddr.Address LIKE '%638%' MAXRESULTS 50
2025-04-17 21:46:54,491 - CFOAgentLogger - ERROR - QuickBooks API error: 400 - {"Fault": {"Error": [{"Message": "Error parsing query", "Detail": "QueryParserError: Encountered <OR> \"OR\" at line 1, column 55", "code": "4000"}], "type": "ValidationFault"}, "time": "2025-04-17T18:46:53.734-07:00"}
NoneType: None
2025-04-17 21:46:54,506 - CFOAgentLogger - ERROR - QuickBooks API request error: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Customer+WHERE+DisplayName+LIKE+%27%25638%25%27+OR+CompanyName+LIKE+%27%25638%25%27+OR+BillAddr.Line1+LIKE+%27%25638%25%27+OR+ShipAddr.Line1+LIKE+%27%25638%25%27+OR+PrimaryEmailAddr.Address+LIKE+%27%25638%25%27+MAXRESULTS+50
Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 137, in _make_api_request
    response.raise_for_status()
  File "C:\Users\Matt\AppData\Roaming\Python\Python312\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Customer+WHERE+DisplayName+LIKE+%27%25638%25%27+OR+CompanyName+LIKE+%27%25638%25%27+OR+BillAddr.Line1+LIKE+%27%25638%25%27+OR+ShipAddr.Line1+LIKE+%27%25638%25%27+OR+PrimaryEmailAddr.Address+LIKE+%27%25638%25%27+MAXRESULTS+50
2025-04-17 21:46:54,507 - CFOAgentLogger - ERROR - QB query error searching Customer for word '638': {'Fault': {'Error': [{'Message': 'Error parsing query', 'Detail': 'QueryParserError: Encountered <OR> "OR" at line 1, column 55', 'code': '4000'}], 'type': 'ValidationFault'}, 'time': '2025-04-17T18:46:53.734-07:00'}
2025-04-17 21:46:54,507 - CFOAgentLogger - INFO - Executing query for word 'rhode' in Customer: SELECT * FROM Customer WHERE DisplayName LIKE '%rhode%' OR CompanyName LIKE '%rhode%' OR BillAddr.Line1 LIKE '%rhode%' OR ShipAddr.Line1 LIKE '%rhode%' OR PrimaryEmailAddr.Address LIKE '%rhode%' MAXRESULTS 50
2025-04-17 21:46:55,225 - CFOAgentLogger - ERROR - QuickBooks API error: 400 - {"Fault": {"Error": [{"Message": "Error parsing query", "Detail": "QueryParserError: Encountered <OR> \"OR\" at line 1, column 57", "code": "4000"}], "type": "ValidationFault"}, "time": "2025-04-17T18:46:54.451-07:00"}
NoneType: None
2025-04-17 21:46:55,225 - CFOAgentLogger - ERROR - QuickBooks API request error: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Customer+WHERE+DisplayName+LIKE+%27%25rhode%25%27+OR+CompanyName+LIKE+%27%25rhode%25%27+OR+BillAddr.Line1+LIKE+%27%25rhode%25%27+OR+ShipAddr.Line1+LIKE+%27%25rhode%25%27+OR+PrimaryEmailAddr.Address+LIKE+%27%25rhode%25%27+MAXRESULTS+50
Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 137, in _make_api_request
    response.raise_for_status()
  File "C:\Users\Matt\AppData\Roaming\Python\Python312\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Customer+WHERE+DisplayName+LIKE+%27%25rhode%25%27+OR+CompanyName+LIKE+%27%25rhode%25%27+OR+BillAddr.Line1+LIKE+%27%25rhode%25%27+OR+ShipAddr.Line1+LIKE+%27%25rhode%25%27+OR+PrimaryEmailAddr.Address+LIKE+%27%25rhode%25%27+MAXRESULTS+50
2025-04-17 21:46:55,225 - CFOAgentLogger - ERROR - QB query error searching Customer for word 'rhode': {'Fault': {'Error': [{'Message': 'Error parsing query', 'Detail': 'QueryParserError: Encountered <OR> "OR" at line 1, column 57', 'code': '4000'}], 'type': 'ValidationFault'}, 'time': '2025-04-17T18:46:54.451-07:00'}
2025-04-17 21:46:55,225 - CFOAgentLogger - INFO - Executing query for word '638' in Estimate: SELECT * FROM Estimate WHERE DocNumber LIKE '%638%' OR PrivateNote LIKE '%638%' MAXRESULTS 50
2025-04-17 21:46:55,941 - CFOAgentLogger - ERROR - QuickBooks API error: 400 - {"Fault": {"Error": [{"Message": "Error parsing query", "Detail": "QueryParserError: Encountered <OR> \"OR\" at line 1, column 53", "code": "4000"}], "type": "ValidationFault"}, "time": "2025-04-17T18:46:55.181-07:00"}
NoneType: None
2025-04-17 21:46:55,941 - CFOAgentLogger - ERROR - QuickBooks API request error: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Estimate+WHERE+DocNumber+LIKE+%27%25638%25%27+OR+PrivateNote+LIKE+%27%25638%25%27+MAXRESULTS+50
Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 137, in _make_api_request
    response.raise_for_status()
  File "C:\Users\Matt\AppData\Roaming\Python\Python312\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Estimate+WHERE+DocNumber+LIKE+%27%25638%25%27+OR+PrivateNote+LIKE+%27%25638%25%27+MAXRESULTS+50
2025-04-17 21:46:55,941 - CFOAgentLogger - ERROR - QB query error searching Estimate for word '638': {'Fault': {'Error': [{'Message': 'Error parsing query', 'Detail': 'QueryParserError: Encountered <OR> "OR" at line 1, column 53', 'code': '4000'}], 'type': 'ValidationFault'}, 'time': '2025-04-17T18:46:55.181-07:00'}
2025-04-17 21:46:55,941 - CFOAgentLogger - INFO - Executing query for word 'rhode' in Estimate: SELECT * FROM Estimate WHERE DocNumber LIKE '%rhode%' OR PrivateNote LIKE '%rhode%' MAXRESULTS 50
2025-04-17 21:46:56,641 - CFOAgentLogger - ERROR - QuickBooks API error: 400 - {"Fault": {"Error": [{"Message": "Error parsing query", "Detail": "QueryParserError: Encountered <OR> \"OR\" at line 1, column 55", "code": "4000"}], "type": "ValidationFault"}, "time": "2025-04-17T18:46:55.876-07:00"}
NoneType: None
2025-04-17 21:46:56,641 - CFOAgentLogger - ERROR - QuickBooks API request error: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Estimate+WHERE+DocNumber+LIKE+%27%25rhode%25%27+OR+PrivateNote+LIKE+%27%25rhode%25%27+MAXRESULTS+50
Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 137, in _make_api_request
    response.raise_for_status()
  File "C:\Users\Matt\AppData\Roaming\Python\Python312\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Estimate+WHERE+DocNumber+LIKE+%27%25rhode%25%27+OR+PrivateNote+LIKE+%27%25rhode%25%27+MAXRESULTS+50
2025-04-17 21:46:56,641 - CFOAgentLogger - ERROR - QB query error searching Estimate for word 'rhode': {'Fault': {'Error': [{'Message': 'Error parsing query', 'Detail': 'QueryParserError: Encountered <OR> "OR" at line 1, column 55', 'code': '4000'}], 'type': 'ValidationFault'}, 'time': '2025-04-17T18:46:55.876-07:00'}
2025-04-17 21:46:56,641 - CFOAgentLogger - INFO - Total unique Customer records found across all words: 0
2025-04-17 21:46:56,641 - CFOAgentLogger - INFO - Kept 0 active Customer records.
2025-04-17 21:46:56,641 - CFOAgentLogger - INFO - Total unique Estimate records found across all words: 0
2025-04-17 21:46:56,641 - CFOAgentLogger - INFO - Kept 0 active Estimate records.
2025-04-17 21:46:56,653 - CFOAgentLogger - INFO - Context search found: 0 Customer(s), 0 Estimate(s).
2025-04-17 21:46:56,653 - CFOAgentLogger - INFO - Executing tool: ask_user_for_clarification for email 1964693c06e1170b with args: {'question': "I searched QuickBooks for '638 rhode' but couldn't find a matching customer or estimate. Could you please provide more details like the customer name or estimate number?"}. Reply target: hello@757handy.com
2025-04-17 21:46:56,655 - CFOAgentLogger - INFO - Sending clarification request to hello@757handy.com: I searched QuickBooks for '638 rhode' but couldn't find a matching customer or estimate. Could you please provide more details like the customer name or estimate number?
2025-04-17 21:46:57,291 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:46:57,476 - CFOAgentLogger - INFO - Email sent to hello@757handy.com with Gmail message ID: 1964693d8971e481
2025-04-17 21:46:57,476 - CFOAgentLogger - INFO - Clarification email sent via tool call to hello@757handy.com
2025-04-17 21:48:52,756 - CFOAgentLogger - INFO - Logger initialized successfully
2025-04-17 21:48:52,756 - CFOAgentLogger - INFO - Loaded configuration from .env
2025-04-17 21:48:52,756 - CFOAgentLogger - INFO - Configuration loaded successfully
2025-04-17 21:48:54,850 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:48:54,850 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:48:54,850 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:48:54,850 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:48:54,850 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:48:54,850 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:48:54,850 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:48:54,850 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:48:54,850 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:48:58,515 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:48:58,515 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:48:58,515 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:48:58,515 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:48:58,515 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:48:58,522 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:48:58,524 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:48:58,526 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:48:58,527 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:48:59,223 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:48:59,324 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:49:00,060 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:49:00,140 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:49:00,141 - CFOAgentLogger - INFO - Attempting Gmail authentication (attempt 1/3)
2025-04-17 21:49:01,000 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:49:01,001 - CFOAgentLogger - INFO - Gmail authentication successful
2025-04-17 21:49:01,005 - CFOAgentLogger - INFO - Instant email checking started (every 2.0s)
2025-04-17 21:49:01,006 - CFOAgentLogger - INFO - Instant email checking started successfully
2025-04-17 21:49:01,093 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:49:01,094 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:49:01,098 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:49:01,100 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:49:01,115 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:49:01,119 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:49:01,122 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:49:01,131 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:49:01,132 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:49:20,263 - CFOAgentLogger - INFO - Processing email from Beach Handyman LLC <hello@757handy.com> with subject: Fwd: generate invoice for 638 rhode
2025-04-17 21:49:20,263 - CFOAgentLogger - INFO - Instant processing of email: 'Fwd: generate invoice for 638 rhode' from Beach Handyman LLC <hello@757handy.com>
2025-04-17 21:49:20,279 - CFOAgentLogger - INFO - Accounting engine initialized successfully
2025-04-17 21:49:20,279 - CFOAgentLogger - INFO - Tax module initialized successfully
2025-04-17 21:49:20,284 - CFOAgentLogger - INFO - OpenAI API initialized successfully
2025-04-17 21:49:20,284 - CFOAgentLogger - INFO - Invoice creator initialized
2025-04-17 21:49:20,285 - CFOAgentLogger - INFO - Initializing Gmail authenticator
2025-04-17 21:49:20,299 - CFOAgentLogger - INFO - Email monitor initialized with instant checking capabilities
2025-04-17 21:49:20,300 - CFOAgentLogger - INFO - Approval workflow initialized
2025-04-17 21:49:20,301 - CFOAgentLogger - INFO - Email monitor set in approval workflow
2025-04-17 21:49:20,301 - CFOAgentLogger - INFO - Application components initialized successfully
2025-04-17 21:49:20,337 - CFOAgentLogger - INFO - Processing new email via LLM: ID=1964695fef803b41, From='Beach Handyman LLC <hello@757handy.com>', Subject='Fwd: generate invoice for 638 rhode'
2025-04-17 21:49:20,338 - CFOAgentLogger - INFO - Simulating LLM response for email body: Matt Porter
Owner / Operations Manager
*Beach Handyman LLC*
757handy.com
*757-354-4577*


---------- Forwarded message ---------
From: Beach Handyman LLC <hello@757handy.com>
Date: Thu, Apr 1...
2025-04-17 21:49:20,342 - CFOAgentLogger - INFO - LLM Simulation: Detected invoice creation request.
2025-04-17 21:49:20,343 - CFOAgentLogger - INFO - LLM Simulation: Extracted customer query: '638 rhode'
2025-04-17 21:49:20,344 - CFOAgentLogger - INFO - LLM Simulation: Extracted amount: None
2025-04-17 21:49:20,345 - CFOAgentLogger - INFO - LLM Simulation: Extracted estimate ID: None
2025-04-17 21:49:20,346 - CFOAgentLogger - INFO - LLM Simulation: Choosing 'search_quickbooks_context' (missing amount/estimate).
2025-04-17 21:49:20,346 - CFOAgentLogger - INFO - LLM requested tool: search_quickbooks_context with term: '638 rhode'
2025-04-17 21:49:20,348 - CFOAgentLogger - INFO - Executing tool: search_quickbooks_context for email 1964695fef803b41 with args: {'search_term': '638 rhode'}. Reply target: hello@757handy.com
2025-04-17 21:49:20,349 - CFOAgentLogger - INFO - Calling qb_api.search_quickbooks for term '638 rhode' in entities ['Customer', 'Estimate']
2025-04-17 21:49:20,350 - CFOAgentLogger - INFO - Executing granular query for word '638' in Customer.DisplayName: SELECT * FROM Customer WHERE DisplayName LIKE '%638%' MAXRESULTS 50
2025-04-17 21:49:20,895 - CFOAgentLogger - INFO - Received new refresh token
2025-04-17 21:49:20,906 - CFOAgentLogger - INFO - Successfully refreshed QuickBooks access token
2025-04-17 21:49:21,973 - CFOAgentLogger - INFO - Executing granular query for word '638' in Customer.CompanyName: SELECT * FROM Customer WHERE CompanyName LIKE '%638%' MAXRESULTS 50
2025-04-17 21:49:22,471 - CFOAgentLogger - INFO - Executing granular query for word '638' in Customer.BillAddr.Line1: SELECT * FROM Customer WHERE BillAddr.Line1 LIKE '%638%' MAXRESULTS 50
2025-04-17 21:49:23,207 - CFOAgentLogger - ERROR - QuickBooks API error: 400 - {"Fault": {"Error": [{"Message": "Invalid query", "Detail": "QueryValidationError: Property BillAddr.Line1 not found for Entity Customer", "code": "4001"}], "type": "ValidationFault"}, "time": "2025-04-17T18:49:22.451-07:00"}
NoneType: None
2025-04-17 21:49:23,207 - CFOAgentLogger - ERROR - QuickBooks API request error: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Customer+WHERE+BillAddr.Line1+LIKE+%27%25638%25%27+MAXRESULTS+50
Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 137, in _make_api_request
    response.raise_for_status()
  File "C:\Users\Matt\AppData\Roaming\Python\Python312\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Customer+WHERE+BillAddr.Line1+LIKE+%27%25638%25%27+MAXRESULTS+50
2025-04-17 21:49:23,223 - CFOAgentLogger - ERROR - QB query error searching Customer.BillAddr.Line1 for word '638': {'Fault': {'Error': [{'Message': 'Invalid query', 'Detail': 'QueryValidationError: Property BillAddr.Line1 not found for Entity Customer', 'code': '4001'}], 'type': 'ValidationFault'}, 'time': '2025-04-17T18:49:22.451-07:00'}
2025-04-17 21:49:23,225 - CFOAgentLogger - INFO - Executing granular query for word '638' in Customer.ShipAddr.Line1: SELECT * FROM Customer WHERE ShipAddr.Line1 LIKE '%638%' MAXRESULTS 50
2025-04-17 21:49:24,057 - CFOAgentLogger - ERROR - QuickBooks API error: 400 - {"Fault": {"Error": [{"Message": "Invalid query", "Detail": "QueryValidationError: Property ShipAddr.Line1 not found for Entity Customer", "code": "4001"}], "type": "ValidationFault"}, "time": "2025-04-17T18:49:23.292-07:00"}
NoneType: None
2025-04-17 21:49:24,057 - CFOAgentLogger - ERROR - QuickBooks API request error: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Customer+WHERE+ShipAddr.Line1+LIKE+%27%25638%25%27+MAXRESULTS+50
Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 137, in _make_api_request
    response.raise_for_status()
  File "C:\Users\Matt\AppData\Roaming\Python\Python312\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Customer+WHERE+ShipAddr.Line1+LIKE+%27%25638%25%27+MAXRESULTS+50
2025-04-17 21:49:24,057 - CFOAgentLogger - ERROR - QB query error searching Customer.ShipAddr.Line1 for word '638': {'Fault': {'Error': [{'Message': 'Invalid query', 'Detail': 'QueryValidationError: Property ShipAddr.Line1 not found for Entity Customer', 'code': '4001'}], 'type': 'ValidationFault'}, 'time': '2025-04-17T18:49:23.292-07:00'}
2025-04-17 21:49:24,057 - CFOAgentLogger - INFO - Executing granular query for word '638' in Customer.PrimaryEmailAddr.Address: SELECT * FROM Customer WHERE PrimaryEmailAddr.Address LIKE '%638%' MAXRESULTS 50
2025-04-17 21:49:24,546 - CFOAgentLogger - ERROR - QuickBooks API error: 400 - {"Fault": {"Error": [{"Message": "Invalid query", "Detail": "QueryValidationError: Property PrimaryEmailAddr.Address not found for Entity Customer", "code": "4001"}], "type": "ValidationFault"}, "time": "2025-04-17T18:49:23.778-07:00"}
NoneType: None
2025-04-17 21:49:24,548 - CFOAgentLogger - ERROR - QuickBooks API request error: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Customer+WHERE+PrimaryEmailAddr.Address+LIKE+%27%25638%25%27+MAXRESULTS+50
Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 137, in _make_api_request
    response.raise_for_status()
  File "C:\Users\Matt\AppData\Roaming\Python\Python312\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Customer+WHERE+PrimaryEmailAddr.Address+LIKE+%27%25638%25%27+MAXRESULTS+50
2025-04-17 21:49:24,550 - CFOAgentLogger - ERROR - QB query error searching Customer.PrimaryEmailAddr.Address for word '638': {'Fault': {'Error': [{'Message': 'Invalid query', 'Detail': 'QueryValidationError: Property PrimaryEmailAddr.Address not found for Entity Customer', 'code': '4001'}], 'type': 'ValidationFault'}, 'time': '2025-04-17T18:49:23.778-07:00'}
2025-04-17 21:49:24,551 - CFOAgentLogger - INFO - Executing granular query for word 'rhode' in Customer.DisplayName: SELECT * FROM Customer WHERE DisplayName LIKE '%rhode%' MAXRESULTS 50
2025-04-17 21:49:25,257 - CFOAgentLogger - INFO - Executing granular query for word 'rhode' in Customer.CompanyName: SELECT * FROM Customer WHERE CompanyName LIKE '%rhode%' MAXRESULTS 50
2025-04-17 21:49:26,023 - CFOAgentLogger - INFO - Executing granular query for word 'rhode' in Customer.BillAddr.Line1: SELECT * FROM Customer WHERE BillAddr.Line1 LIKE '%rhode%' MAXRESULTS 50
2025-04-17 21:49:26,747 - CFOAgentLogger - ERROR - QuickBooks API error: 400 - {"Fault": {"Error": [{"Message": "Invalid query", "Detail": "QueryValidationError: Property BillAddr.Line1 not found for Entity Customer", "code": "4001"}], "type": "ValidationFault"}, "time": "2025-04-17T18:49:25.918-07:00"}
NoneType: None
2025-04-17 21:49:26,747 - CFOAgentLogger - ERROR - QuickBooks API request error: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Customer+WHERE+BillAddr.Line1+LIKE+%27%25rhode%25%27+MAXRESULTS+50
Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 137, in _make_api_request
    response.raise_for_status()
  File "C:\Users\Matt\AppData\Roaming\Python\Python312\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Customer+WHERE+BillAddr.Line1+LIKE+%27%25rhode%25%27+MAXRESULTS+50
2025-04-17 21:49:26,747 - CFOAgentLogger - ERROR - QB query error searching Customer.BillAddr.Line1 for word 'rhode': {'Fault': {'Error': [{'Message': 'Invalid query', 'Detail': 'QueryValidationError: Property BillAddr.Line1 not found for Entity Customer', 'code': '4001'}], 'type': 'ValidationFault'}, 'time': '2025-04-17T18:49:25.918-07:00'}
2025-04-17 21:49:26,747 - CFOAgentLogger - INFO - Executing granular query for word 'rhode' in Customer.ShipAddr.Line1: SELECT * FROM Customer WHERE ShipAddr.Line1 LIKE '%rhode%' MAXRESULTS 50
2025-04-17 21:49:27,219 - CFOAgentLogger - ERROR - QuickBooks API error: 400 - {"Fault": {"Error": [{"Message": "Invalid query", "Detail": "QueryValidationError: Property ShipAddr.Line1 not found for Entity Customer", "code": "4001"}], "type": "ValidationFault"}, "time": "2025-04-17T18:49:26.455-07:00"}
NoneType: None
2025-04-17 21:49:27,219 - CFOAgentLogger - ERROR - QuickBooks API request error: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Customer+WHERE+ShipAddr.Line1+LIKE+%27%25rhode%25%27+MAXRESULTS+50
Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 137, in _make_api_request
    response.raise_for_status()
  File "C:\Users\Matt\AppData\Roaming\Python\Python312\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Customer+WHERE+ShipAddr.Line1+LIKE+%27%25rhode%25%27+MAXRESULTS+50
2025-04-17 21:49:27,219 - CFOAgentLogger - ERROR - QB query error searching Customer.ShipAddr.Line1 for word 'rhode': {'Fault': {'Error': [{'Message': 'Invalid query', 'Detail': 'QueryValidationError: Property ShipAddr.Line1 not found for Entity Customer', 'code': '4001'}], 'type': 'ValidationFault'}, 'time': '2025-04-17T18:49:26.455-07:00'}
2025-04-17 21:49:27,219 - CFOAgentLogger - INFO - Executing granular query for word 'rhode' in Customer.PrimaryEmailAddr.Address: SELECT * FROM Customer WHERE PrimaryEmailAddr.Address LIKE '%rhode%' MAXRESULTS 50
2025-04-17 21:49:27,964 - CFOAgentLogger - ERROR - QuickBooks API error: 400 - {"Fault": {"Error": [{"Message": "Invalid query", "Detail": "QueryValidationError: Property PrimaryEmailAddr.Address not found for Entity Customer", "code": "4001"}], "type": "ValidationFault"}, "time": "2025-04-17T18:49:27.195-07:00"}
NoneType: None
2025-04-17 21:49:27,965 - CFOAgentLogger - ERROR - QuickBooks API request error: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Customer+WHERE+PrimaryEmailAddr.Address+LIKE+%27%25rhode%25%27+MAXRESULTS+50
Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 137, in _make_api_request
    response.raise_for_status()
  File "C:\Users\Matt\AppData\Roaming\Python\Python312\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Customer+WHERE+PrimaryEmailAddr.Address+LIKE+%27%25rhode%25%27+MAXRESULTS+50
2025-04-17 21:49:27,968 - CFOAgentLogger - ERROR - QB query error searching Customer.PrimaryEmailAddr.Address for word 'rhode': {'Fault': {'Error': [{'Message': 'Invalid query', 'Detail': 'QueryValidationError: Property PrimaryEmailAddr.Address not found for Entity Customer', 'code': '4001'}], 'type': 'ValidationFault'}, 'time': '2025-04-17T18:49:27.195-07:00'}
2025-04-17 21:49:27,970 - CFOAgentLogger - INFO - Executing granular query for word '638' in Estimate.DocNumber: SELECT * FROM Estimate WHERE DocNumber LIKE '%638%' MAXRESULTS 50
2025-04-17 21:49:29,046 - CFOAgentLogger - INFO - Executing granular query for word '638' in Estimate.PrivateNote: SELECT * FROM Estimate WHERE PrivateNote LIKE '%638%' MAXRESULTS 50
2025-04-17 21:49:29,791 - CFOAgentLogger - ERROR - QuickBooks API error: 400 - {"Fault": {"Error": [{"Message": "Invalid query", "Detail": "QueryValidationError: property 'PrivateNote' is not queryable", "code": "4001"}], "type": "ValidationFault"}, "time": "2025-04-17T18:49:29.025-07:00"}
NoneType: None
2025-04-17 21:49:29,791 - CFOAgentLogger - ERROR - QuickBooks API request error: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Estimate+WHERE+PrivateNote+LIKE+%27%25638%25%27+MAXRESULTS+50
Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 137, in _make_api_request
    response.raise_for_status()
  File "C:\Users\Matt\AppData\Roaming\Python\Python312\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Estimate+WHERE+PrivateNote+LIKE+%27%25638%25%27+MAXRESULTS+50
2025-04-17 21:49:29,791 - CFOAgentLogger - ERROR - QB query error searching Estimate.PrivateNote for word '638': {'Fault': {'Error': [{'Message': 'Invalid query', 'Detail': "QueryValidationError: property 'PrivateNote' is not queryable", 'code': '4001'}], 'type': 'ValidationFault'}, 'time': '2025-04-17T18:49:29.025-07:00'}
2025-04-17 21:49:29,791 - CFOAgentLogger - INFO - Executing granular query for word 'rhode' in Estimate.DocNumber: SELECT * FROM Estimate WHERE DocNumber LIKE '%rhode%' MAXRESULTS 50
2025-04-17 21:49:30,600 - CFOAgentLogger - INFO - Executing granular query for word 'rhode' in Estimate.PrivateNote: SELECT * FROM Estimate WHERE PrivateNote LIKE '%rhode%' MAXRESULTS 50
2025-04-17 21:49:31,317 - CFOAgentLogger - ERROR - QuickBooks API error: 400 - {"Fault": {"Error": [{"Message": "Invalid query", "Detail": "QueryValidationError: property 'PrivateNote' is not queryable", "code": "4001"}], "type": "ValidationFault"}, "time": "2025-04-17T18:49:30.547-07:00"}
NoneType: None
2025-04-17 21:49:31,317 - CFOAgentLogger - ERROR - QuickBooks API request error: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Estimate+WHERE+PrivateNote+LIKE+%27%25rhode%25%27+MAXRESULTS+50
Traceback (most recent call last):
  File "C:\Users\Matt\CFO_Agent\quickbooks_api.py", line 137, in _make_api_request
    response.raise_for_status()
  File "C:\Users\Matt\AppData\Roaming\Python\Python312\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://quickbooks.api.intuit.com/v3/company/9130354335874546/query?query=SELECT+%2A+FROM+Estimate+WHERE+PrivateNote+LIKE+%27%25rhode%25%27+MAXRESULTS+50
2025-04-17 21:49:31,317 - CFOAgentLogger - ERROR - QB query error searching Estimate.PrivateNote for word 'rhode': {'Fault': {'Error': [{'Message': 'Invalid query', 'Detail': "QueryValidationError: property 'PrivateNote' is not queryable", 'code': '4001'}], 'type': 'ValidationFault'}, 'time': '2025-04-17T18:49:30.547-07:00'}
2025-04-17 21:49:31,317 - CFOAgentLogger - INFO - Total unique Customer records found across all words: 0
2025-04-17 21:49:31,317 - CFOAgentLogger - INFO - Kept 0 active Customer records.
2025-04-17 21:49:31,317 - CFOAgentLogger - INFO - Total unique Estimate records found across all words: 1
2025-04-17 21:49:31,324 - CFOAgentLogger - INFO - Kept 0 active Estimate records.
2025-04-17 21:49:31,325 - CFOAgentLogger - INFO - Context search found: 0 Customer(s), 0 Estimate(s).
2025-04-17 21:49:31,325 - CFOAgentLogger - INFO - Executing tool: ask_user_for_clarification for email 1964695fef803b41 with args: {'question': "I searched QuickBooks for '638 rhode' but couldn't find a matching customer or estimate. Could you please provide more details like the customer name or estimate number?"}. Reply target: hello@757handy.com
2025-04-17 21:49:31,326 - CFOAgentLogger - INFO - Sending clarification request to hello@757handy.com: I searched QuickBooks for '638 rhode' but couldn't find a matching customer or estimate. Could you please provide more details like the customer name or estimate number?
2025-04-17 21:49:31,963 - CFOAgentLogger - INFO - Gmail API connection validated successfully for cfoledger@gmail.com
2025-04-17 21:49:32,236 - CFOAgentLogger - INFO - Email sent to hello@757handy.com with Gmail message ID: 1964696356d5f0c5
2025-04-17 21:49:32,236 - CFOAgentLogger - INFO - Clarification email sent via tool call to hello@757handy.com
